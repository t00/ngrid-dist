import { __awaiter } from "tslib";
import { PblNgridHarness } from './ngrid-component-harness';
export var ScrollToLocation;
(function (ScrollToLocation) {
    ScrollToLocation[ScrollToLocation["VerticalStart"] = 0] = "VerticalStart";
    ScrollToLocation[ScrollToLocation["VerticalEnd"] = 1] = "VerticalEnd";
    ScrollToLocation[ScrollToLocation["HorizontalStart"] = 2] = "HorizontalStart";
    ScrollToLocation[ScrollToLocation["HorizontalEnd"] = 3] = "HorizontalEnd";
})(ScrollToLocation || (ScrollToLocation = {}));
class PblNgridHarnessActions extends PblNgridHarness {
    waitForRenderChanged(fn, timeoutMs = 500, frequency = 10) {
        return __awaiter(this, void 0, void 0, function* () {
            const rowIdentities = yield this.getDataRows().then(rows => rows.map(r => r.getRowIdentity())).then(rows => Promise.all(rows));
            const result = typeof fn === 'function' ? yield fn() : undefined;
            frequency = Math.max(frequency, 1);
            timeoutMs = Math.max(timeoutMs, 0);
            const interval = Math.floor(timeoutMs / frequency);
            const wait = () => new Promise(res => { setTimeout(res, interval); });
            while (frequency > 0) {
                yield wait();
                const newRows = yield this.getDataRows();
                if (rowIdentities.length !== newRows.length) {
                    return;
                }
                for (let i = 0; i < rowIdentities.length; i++) {
                    const newIdentity = newRows[i] ? (yield newRows[i].getRowIdentity()) : null;
                    if (newIdentity !== rowIdentities[i]) {
                        return;
                    }
                }
                frequency -= 1;
            }
            return result;
        });
    }
    getColumnIds() {
        return __awaiter(this, void 0, void 0, function* () {
            return this.getColumnHeaderRow()
                .then(header => header.getCells())
                .then(columns => Promise.all(columns.map(c => c.getColumnId())));
        });
    }
    getViewPortData() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.forceStabilize();
            return this.getDataRows()
                .then(rows => rows.map(r => r.getCells().then(cells => cells.map(c => c.getText()))))
                .then(rows => Promise.all(rows.map(pRow => pRow.then(row => Promise.all(row)))));
        });
    }
    scrollTo(x, y) {
        return __awaiter(this, void 0, void 0, function* () {
            // TODO: support protractor env
            scrollDom(yield this.locatorFor('pbl-cdk-virtual-scroll-viewport')(), x, y);
        });
    }
    scrollToLocation(location) {
        return __awaiter(this, void 0, void 0, function* () {
            // TODO: support protractor env
            const viewPort = yield this.locatorFor('pbl-cdk-virtual-scroll-viewport')();
            const element = viewPort.element;
            let x = element.scrollLeft;
            let y = element.scrollTop;
            switch (location) {
                case ScrollToLocation.HorizontalStart:
                    x = 0;
                    break;
                case ScrollToLocation.HorizontalEnd:
                    x = element.scrollWidth;
                    break;
                case ScrollToLocation.VerticalStart:
                    y = 0;
                    break;
                case ScrollToLocation.VerticalEnd:
                    y = element.scrollHeight;
                    break;
            }
            scrollDom(viewPort, x, y);
        });
    }
}
function scrollDom(viewPort, x, y) {
    return __awaiter(this, void 0, void 0, function* () {
        const element = viewPort.element;
        element.scroll(x, y);
    });
}
const keys = Object.getOwnPropertyNames(PblNgridHarnessActions.prototype);
for (const key of keys) {
    PblNgridHarness.register(key, PblNgridHarnessActions.prototype[key]);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvbmdyaWQvdGVzdGluZy9zcmMvbGliL2dyaWQvYWN0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBb0M1RCxNQUFNLENBQU4sSUFBWSxnQkFLWDtBQUxELFdBQVksZ0JBQWdCO0lBQzFCLHlFQUFhLENBQUE7SUFDYixxRUFBVyxDQUFBO0lBQ1gsNkVBQWUsQ0FBQTtJQUNmLHlFQUFhLENBQUE7QUFDZixDQUFDLEVBTFcsZ0JBQWdCLEtBQWhCLGdCQUFnQixRQUszQjtBQUVELE1BQU0sc0JBQXVCLFNBQVEsZUFBZTtJQUU1QyxvQkFBb0IsQ0FBZ0IsRUFBcUIsRUFBRSxTQUFTLEdBQUcsR0FBRyxFQUFFLFNBQVMsR0FBRyxFQUFFOztZQUM5RixNQUFNLGFBQWEsR0FBRyxNQUFNLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFFLENBQUM7WUFFakksTUFBTSxNQUFNLEdBQU0sT0FBTyxFQUFFLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFFcEUsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ25DLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNuQyxNQUFNLFFBQVEsR0FB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M0IsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQztZQUUxQixRQUFRLFFBQVEsRUFBRTtnQkFDaEIsS0FBSyxnQkFBZ0IsQ0FBQyxlQUFlO29CQUNuQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNOLE1BQU07Z0JBQ1IsS0FBSyxnQkFBZ0IsQ0FBQyxhQUFhO29CQUNqQyxDQUFDLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQztvQkFDeEIsTUFBTTtnQkFDUixLQUFLLGdCQUFnQixDQUFDLGFBQWE7b0JBQ2pDLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ04sTUFBTTtnQkFDUixLQUFLLGdCQUFnQixDQUFDLFdBQVc7b0JBQy9CLENBQUMsR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDO29CQUN6QixNQUFNO2FBQ1Q7WUFDRCxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUM1QixDQUFDO0tBQUE7Q0FDRjtBQUVELFNBQWUsU0FBUyxDQUFDLFFBQXFCLEVBQUUsQ0FBUyxFQUFFLENBQVM7O1FBQ2xFLE1BQU0sT0FBTyxHQUFJLFFBQTRCLENBQUMsT0FBTyxDQUFDO1FBQ3RELE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7Q0FBQTtBQUVELE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTLENBQXdDLENBQUM7QUFDakgsS0FBSyxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUU7SUFDdEIsZUFBZSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsc0JBQXNCLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7Q0FDckUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0RWxlbWVudCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay90ZXN0aW5nJztcbmltcG9ydCB7IFVuaXRUZXN0RWxlbWVudCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay90ZXN0aW5nL3Rlc3RiZWQnO1xuaW1wb3J0IHsgUGJsTmdyaWRIYXJuZXNzIH0gZnJvbSAnLi9uZ3JpZC1jb21wb25lbnQtaGFybmVzcyc7XG5cbmRlY2xhcmUgbW9kdWxlICcuL25ncmlkLWNvbXBvbmVudC1oYXJuZXNzJyB7XG4gIGludGVyZmFjZSBQYmxOZ3JpZEhhcm5lc3Mge1xuICAgIC8qKlxuICAgICAqIFRha2VzIGFuIGltbWVkaWF0ZSBzbmFwc2hvdCBvZiB0aGUgY3VycmVudCByb3dzIHJlbmRlcmVkIGluIHRoZSB2aWV3IGFuZCB0aGVpciBvcmRlci4gKG9ubHkgc3RvcmVzIHRoZSByb3cgaWRlbnRpdHksIG5vIGNlbGwgZGF0YSlcbiAgICAgKiBhbmQgdGhlbiBwb2xsIHRoZSB2aWV3IHRvIGRldGVjdCB3aGVuIHRoZSByb3cgaGF2ZSBiZWVuIHJlLXJlbmRlcmVkLlxuICAgICAqXG4gICAgICogWW91IGNhbiBwcm92aWRlIGEgZnVuY3Rpb24gdGhhdCB3aWxsIHJ1biByaWdodCBhZnRlciB0aGUgc25hcHNob3QsIGFsbG93aW5nIGNoYW5nZXMgdG8gYmUgZXhlY3V0ZWQgcmlnaHQgYWZ0ZXIgdGhlIHNuYXBzaG90LlxuICAgICAqIFRoZSBmdW5jdGlvbiBtdXN0IHJldHVybiBhIHByb21pc2UgYW5kIHRoZSBwcm9taXNlIHZhbHVlIHdpbGwgYmUgcmV0dXJuZWQgYnkgdGhpcyBtZXRob2QuXG4gICAgICpcbiAgICAgKiBPcHRpbWl6aW5nIHJlbmRlciBjaGFuZ2UgZGV0ZWN0aW9uOlxuICAgICAqIERldGVjdGluZyBhIGNoYW5nZSBpbiB0aGUgcm93IHJlbmRlcmluZyBzdGF0ZSBpcyBzaW1wbGUsIGZpcnN0IGEgc25hcHNob3Qgb2YgY3VycmVudCByb3cgaWRlbnRpdGllcyBpcyBzYXZlcyAoQSBjb2xsZWN0aW9uIG9mIHN0cmluZ3MpXG4gICAgICogYW5kIHRoZW4sIGZvciBhIHByZWRlZmluZWQgcGVyaW9kIG9mIHRpbWUgKHRpbWVvdXQpIGl0IGlzIHNhbXBsZWQgYWdhaW5zdCB0aGUgdmlldyBhdCBwcmVkZWZpbmVkIGludGVydmFscyAoZnJlcXVlbmN5KVxuICAgICAqIFlvdSBjYW4gb3B0aW1pemUgdGhlIHByb2Nlc3MgYnkgY2hhbmdpbmcgdGhlIGZyZXF1ZW5jeSBhbmQvb3IgdGltZW91dC5cbiAgICAgKiBBIGxvbmdlciB0aW1lb3V0IG1lYW5zIG1vcmUgdGltZSB0byB0ZXN0IGJ1dCBhbGxvd2luZyBtb3JlIHRpbWUgZm9yIHJlbmRlciBoZWF2eSBvcGVyYXRpb25zXG4gICAgICogQSBiaWdnZXIgZnJlcXVlbmN5IG1lYW5zIHNhbXBsaW5nIG1vcmUgb2Z0ZW4sIGFsbG93aW5nIGNoYW5nZSB0byBwb3AgZmFzdGVyXG4gICAgICpcbiAgICAgKiBGb3IgZXhhbXBsZSwgYSB0aW1lb3V0IG9mIDUwMCAoaGFsZiBzZWNvbmQpIGFuZCBmcmVxdWVuY3kgb2YgMTAgbWVhbnMgdGhlIHZpZXcgaXMgc2FtcGxlcyBldmVyeSA1MG1zLCAxMCB0aW1lcy5cbiAgICAgKlxuICAgICAqID4gVGhpcyBtaW1pY3MgdGhlIGBvblJlbmRlckNoYW5nZWRgIGV2ZW50IG9mIHRoZSBgRGF0YVNvdXJjZWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZm4gQSBmdW5jdGlvbiB0aGF0IHdpbGwgcmV0dXJuIGEgcHJvbWlzZSBmb3IgYW4gb3BlcmF0aW9uIHRoYXQgbWlnaHQgY2F1c2UgYSByZW5kZXIgY2hhbmdlXG4gICAgICogQHBhcmFtIHRpbWVvdXRNcyBUaGUgdG90YWwgdGltZSAoaW4gbXMpIHRvIHdhaXQgYmVmb3JlIGdpdmluZyB1cCAoZGVmYXVsdDogNTAwKVxuICAgICAqIEBwYXJhbSBmcmVxdWVuY3kgVGhlIHRvdGFsIG51bWJlciBvZiBpdGVyYXRpb25zIHRvIHNhbXBsZSB3aXRoaW4gdGhlIHRpbWVvdXQgKGRlZmF1bHQ6IDEwKVxuICAgICAqL1xuICAgIHdhaXRGb3JSZW5kZXJDaGFuZ2VkPFQgPSB1bmRlZmluZWQ+KGZuPzogKCkgPT4gUHJvbWlzZTxUPiwgdGltZW91dE1zPzogbnVtYmVyLCBmcmVxdWVuY3k/OiBudW1iZXIpOiBQcm9taXNlPFQ+O1xuXG4gICAgc2Nyb2xsVG9Mb2NhdGlvbihsb2NhdGlvbjogU2Nyb2xsVG9Mb2NhdGlvbik6IFByb21pc2U8dm9pZD47XG4gICAgc2Nyb2xsVG8oeDogbnVtYmVyLCB5OiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+O1xuXG4gICAgZ2V0Q29sdW1uSWRzKCk6IFByb21pc2U8c3RyaW5nW10+O1xuICAgIGdldFZpZXdQb3J0RGF0YSgpOiBQcm9taXNlPHN0cmluZ1tdW10+O1xuICB9XG59XG5cbmV4cG9ydCBlbnVtIFNjcm9sbFRvTG9jYXRpb24ge1xuICBWZXJ0aWNhbFN0YXJ0LFxuICBWZXJ0aWNhbEVuZCxcbiAgSG9yaXpvbnRhbFN0YXJ0LFxuICBIb3Jpem9udGFsRW5kLFxufVxuXG5jbGFzcyBQYmxOZ3JpZEhhcm5lc3NBY3Rpb25zIGV4dGVuZHMgUGJsTmdyaWRIYXJuZXNzIHtcblxuICBhc3luYyB3YWl0Rm9yUmVuZGVyQ2hhbmdlZDxUID0gdW5kZWZpbmVkPihmbj86ICgpID0+IFByb21pc2U8VD4sIHRpbWVvdXRNcyA9IDUwMCwgZnJlcXVlbmN5ID0gMTApOiBQcm9taXNlPFQ+IHtcbiAgICBjb25zdCByb3dJZGVudGl0aWVzID0gYXdhaXQgdGhpcy5nZXREYXRhUm93cygpLnRoZW4ocm93cyA9PiByb3dzLm1hcChyID0+IHIuZ2V0Um93SWRlbnRpdHkoKSkpLnRoZW4oIHJvd3MgPT4gUHJvbWlzZS5hbGwocm93cykgKTtcblxuICAgIGNvbnN0IHJlc3VsdDogVCA9IHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJyA/IGF3YWl0IGZuKCkgOiB1bmRlZmluZWQ7XG5cbiAgICBmcmVxdWVuY3kgPSBNYXRoLm1heChmcmVxdWVuY3ksIDEpO1xuICAgIHRpbWVvdXRNcyA9IE1hdGgubWF4KHRpbWVvdXRNcywgMCk7XG4gICAgY29uc3QgaW50ZXJ2YWwgPSBNYXRoLmZsb29yKHRpbWVvdXRNcyAvIGZyZXF1ZW5jeSk7XG5cbiAgICBjb25zdCB3YWl0ID0gKCkgPT4gbmV3IFByb21pc2UoIHJlcyA9PiB7IHNldFRpbWVvdXQocmVzLCBpbnRlcnZhbCl9KTtcblxuICAgIHdoaWxlIChmcmVxdWVuY3kgPiAwKSB7XG4gICAgICBhd2FpdCB3YWl0KCk7XG5cbiAgICAgIGNvbnN0IG5ld1Jvd3MgPSBhd2FpdCB0aGlzLmdldERhdGFSb3dzKCk7XG4gICAgICBpZiAocm93SWRlbnRpdGllcy5sZW5ndGggIT09IG5ld1Jvd3MubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dJZGVudGl0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IG5ld0lkZW50aXR5ID0gbmV3Um93c1tpXSA/IChhd2FpdCBuZXdSb3dzW2ldLmdldFJvd0lkZW50aXR5KCkpIDogbnVsbDtcbiAgICAgICAgaWYgKG5ld0lkZW50aXR5ICE9PSByb3dJZGVudGl0aWVzW2ldKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZyZXF1ZW5jeSAtPSAxO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBhc3luYyBnZXRDb2x1bW5JZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q29sdW1uSGVhZGVyUm93KClcbiAgICAgIC50aGVuKCBoZWFkZXIgPT4gaGVhZGVyLmdldENlbGxzKCkgKVxuICAgICAgLnRoZW4oIGNvbHVtbnMgPT4gUHJvbWlzZS5hbGwoY29sdW1ucy5tYXAoIGMgPT4gYy5nZXRDb2x1bW5JZCgpICkpICk7XG4gIH1cblxuICBhc3luYyBnZXRWaWV3UG9ydERhdGEoKSB7XG4gICAgYXdhaXQgdGhpcy5mb3JjZVN0YWJpbGl6ZSgpO1xuICAgIHJldHVybiB0aGlzLmdldERhdGFSb3dzKClcbiAgICAgIC50aGVuKCByb3dzID0+IHJvd3MubWFwKCByID0+IHIuZ2V0Q2VsbHMoKS50aGVuKCBjZWxscyA9PiBjZWxscy5tYXAoYyA9PiBjLmdldFRleHQoKSApKSApIClcbiAgICAgIC50aGVuKCByb3dzID0+IFByb21pc2UuYWxsKHJvd3MubWFwKCBwUm93ID0+IHBSb3cudGhlbiggcm93ID0+IFByb21pc2UuYWxsKHJvdykgKSkpKTtcbiAgfVxuXG4gIGFzeW5jIHNjcm9sbFRvKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgLy8gVE9ETzogc3VwcG9ydCBwcm90cmFjdG9yIGVudlxuICAgIHNjcm9sbERvbShhd2FpdCB0aGlzLmxvY2F0b3JGb3IoJ3BibC1jZGstdmlydHVhbC1zY3JvbGwtdmlld3BvcnQnKSgpLCB4LCB5KVxuICB9XG5cbiAgYXN5bmMgc2Nyb2xsVG9Mb2NhdGlvbihsb2NhdGlvbjogU2Nyb2xsVG9Mb2NhdGlvbikge1xuICAgIC8vIFRPRE86IHN1cHBvcnQgcHJvdHJhY3RvciBlbnZcbiAgICBjb25zdCB2aWV3UG9ydCA9IGF3YWl0IHRoaXMubG9jYXRvckZvcigncGJsLWNkay12aXJ0dWFsLXNjcm9sbC12aWV3cG9ydCcpKCk7XG4gICAgY29uc3QgZWxlbWVudCA9ICh2aWV3UG9ydCBhcyBVbml0VGVzdEVsZW1lbnQpLmVsZW1lbnQ7XG4gICAgbGV0IHggPSBlbGVtZW50LnNjcm9sbExlZnQ7XG4gICAgbGV0IHkgPSBlbGVtZW50LnNjcm9sbFRvcDtcblxuICAgIHN3aXRjaCAobG9jYXRpb24pIHtcbiAgICAgIGNhc2UgU2Nyb2xsVG9Mb2NhdGlvbi5Ib3Jpem9udGFsU3RhcnQ6XG4gICAgICAgIHggPSAwO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgU2Nyb2xsVG9Mb2NhdGlvbi5Ib3Jpem9udGFsRW5kOlxuICAgICAgICB4ID0gZWxlbWVudC5zY3JvbGxXaWR0aDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFNjcm9sbFRvTG9jYXRpb24uVmVydGljYWxTdGFydDpcbiAgICAgICAgeSA9IDA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBTY3JvbGxUb0xvY2F0aW9uLlZlcnRpY2FsRW5kOlxuICAgICAgICB5ID0gZWxlbWVudC5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBzY3JvbGxEb20odmlld1BvcnQsIHgsIHkpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNjcm9sbERvbSh2aWV3UG9ydDogVGVzdEVsZW1lbnQsIHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gIGNvbnN0IGVsZW1lbnQgPSAodmlld1BvcnQgYXMgVW5pdFRlc3RFbGVtZW50KS5lbGVtZW50O1xuICBlbGVtZW50LnNjcm9sbCh4LCB5KTtcbn1cblxuY29uc3Qga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKFBibE5ncmlkSGFybmVzc0FjdGlvbnMucHJvdG90eXBlKSBhcyBBcnJheTxrZXlvZiBQYmxOZ3JpZEhhcm5lc3NBY3Rpb25zPjtcbmZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgUGJsTmdyaWRIYXJuZXNzLnJlZ2lzdGVyKGtleSwgUGJsTmdyaWRIYXJuZXNzQWN0aW9ucy5wcm90b3R5cGVba2V5XSlcbn1cbiJdfQ==