export class MetaCellContext {
    constructor() { }
    get $implicit() { return this; }
    // workaround, we need a parameter-less constructor since @ngtools/webpack@8.0.4
    // Non @Injectable classes are now getting addded with hard reference to the ctor params which at the class creation point are undefined
    // forwardRef() will not help since it's not inject by angular, we instantiate the class..
    // probably due to https://github.com/angular/angular-cli/commit/639198499973e0f437f059b3c933c72c733d93d8
    static create(col, grid) {
        const instance = new MetaCellContext();
        instance.col = col;
        instance.grid = grid;
        return instance;
    }
}
export class PblCellContext {
    constructor() {
        this._editing = false;
        this._focused = false;
        this._selected = false;
        this._external = {};
    }
    get $implicit() { return this; }
    get row() { return this.rowContext.$implicit; }
    ;
    get value() { return this.col.getValue(this.row); }
    set value(v) { this.col.setValue(this.row, v); }
    get rowContext() { return this._rowContext; }
    get editing() { return this._editing; }
    get focused() { return this._focused; }
    get selected() { return this._selected; }
    // workaround, we need a parameter-less constructor since @ngtools/webpack@8.0.4
    // Non @Injectable classes are now getting addded with hard reference to the ctor params which at the class creation point are undefined
    // forwardRef() will not help since it's not inject by angular, we instantiate the class..
    // probably due to https://github.com/angular/angular-cli/commit/639198499973e0f437f059b3c933c72c733d93d8
    static create(rowContext, col, extApi) {
        const instance = new PblCellContext();
        instance._rowContext = rowContext;
        instance.col = col;
        instance.extApi = extApi;
        Object.defineProperties(instance, {
            grid: { value: extApi.grid },
            index: { value: extApi.grid.columnApi.indexOf(col) },
        });
        return instance;
    }
    static defaultState() {
        return { editing: false, focused: false, selected: false, external: {} };
    }
    clone(col) {
        const ctx = PblCellContext.create(this._rowContext, col || this.col, this.extApi);
        ctx.fromState(this.getState(), this._rowContext, true);
        return ctx;
    }
    getExternal(key) {
        return this._external[key];
    }
    setExternal(key, value, saveState = false) {
        this._external[key] = value;
        if (saveState) {
            this._rowContext.saveState();
        }
    }
    getState() {
        return {
            editing: this._editing,
            focused: this._focused,
            selected: this._selected,
            external: this._external,
        };
    }
    fromState(state, rowContext, skipRowUpdate) {
        const requiresReset = !skipRowUpdate && this._editing === state.editing;
        this._rowContext = rowContext;
        this._editing = state.editing;
        this._focused = state.focused;
        this._selected = state.selected;
        this._external = state.external;
        if (requiresReset) {
            rowContext.updateCell(this);
        }
    }
    startEdit(markForCheck) {
        if (this.col.editorTpl && !this.editing) {
            this._editing = true;
            this._rowContext.updateCell(this);
            if (markForCheck) {
                this.grid.rowsApi.syncRows('data', true, this.rowContext.index);
            }
        }
    }
    stopEdit(markForCheck) {
        if (this.editing && !this.grid.viewport.isScrolling) {
            this._editing = false;
            this._rowContext.updateCell(this);
            if (markForCheck) {
                this.grid.rowsApi.syncRows('data', this.rowContext.index);
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2VsbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvbmdyaWQvc3JjL2xpYi9ncmlkL2NvbnRleHQvY2VsbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFNQSxNQUFNLE9BQU8sZUFBZTtJQUsxQixnQkFBeUIsQ0FBQztJQUYxQixJQUFJLFNBQVMsS0FBK0IsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBSTFELGdGQUFnRjtJQUNoRix3SUFBd0k7SUFDeEksMEZBQTBGO0lBQzFGLHlHQUF5RztJQUN6RyxNQUFNLENBQUMsTUFBTSxDQUFrRSxHQUFTLEVBQUUsSUFBMkI7UUFDbkgsTUFBTSxRQUFRLEdBQUcsSUFBSSxlQUFlLEVBQVcsQ0FBQztRQUNoRCxRQUFRLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUNuQixRQUFRLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNyQixPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0NBRUY7QUFFRCxNQUFNLE9BQU8sY0FBYztJQXVCekI7UUFUUSxhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixjQUFTLEdBQUcsRUFBRSxDQUFDO0lBTUcsQ0FBQztJQXRCM0IsSUFBSSxTQUFTLEtBQXdCLE9BQU8sSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNuRCxJQUFJLEdBQUcsS0FBUSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUFBLENBQUM7SUFDbkQsSUFBSSxLQUFLLEtBQVUsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3hELElBQUksS0FBSyxDQUFDLENBQU0sSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMs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SSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQztRQUVoQyxJQUFJLGFBQWEsRUFBRTtZQUNqQixVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzdCO0lBQ0gsQ0FBQztJQUVELFNBQVMsQ0FBQyxZQUFzQjtRQUM5QixJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUN2QyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUNyQixJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxJQUFJLFlBQVksRUFBRTtnQkFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNqRTtTQUNGO0lBQ0gsQ0FBQztJQUVELFFBQVEsQ0FBQyxZQUFzQjtRQUM3QixJQUFJLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUU7WUFDbkQsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7WUFDdEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsSUFBSSxZQUFZLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUMzRDtTQUNGO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgX1BibE5ncmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vdG9rZW5zJztcbmltcG9ydCB7IFBibE5ncmlkRXh0ZW5zaW9uQXBpIH0gZnJvbSAnLi4vLi4vZXh0L2dyaWQtZXh0LWFwaSc7XG5pbXBvcnQgeyBDZWxsQ29udGV4dFN0YXRlLCBFeHRlcm5hbENlbGxDb250ZXh0U3RhdGUsIFBibE5ncmlkQ2VsbENvbnRleHQsIFBibE5ncmlkTWV0YUNlbGxDb250ZXh0LCBQYmxOZ3JpZFJvd0NvbnRleHQgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IFBibENvbHVtbiwgUGJsTWV0YUNvbHVtbiB9IGZyb20gJy4uL2NvbHVtbi9tb2RlbCc7XG5pbXBvcnQgeyBQYmxSb3dDb250ZXh0IH0gZnJvbSAnLi9yb3cnO1xuXG5leHBvcnQgY2xhc3MgTWV0YUNlbGxDb250ZXh0PFQgPSBhbnksIFRDb2wgZXh0ZW5kcyBQYmxNZXRhQ29sdW1uIHwgUGJsQ29sdW1uID0gUGJsTWV0YUNvbHVtbj4gaW1wbGVtZW50cyBQYmxOZ3JpZE1ldGFDZWxsQ29udGV4dDxULCBUQ29sPiB7XG4gIGNvbDogVENvbDtcbiAgZ3JpZDogX1BibE5ncmlkQ29tcG9uZW50PGFueT47XG4gIGdldCAkaW1wbGljaXQoKTogTWV0YUNlbGxDb250ZXh0PFQsIFRDb2w+IHsgcmV0dXJuIHRoaXM7IH1cblxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoKSB7fVxuXG4gIC8vIHdvcmthcm91bmQsIHdlIG5lZWQgYSBwYXJhbWV0ZXItbGVzcyBjb25zdHJ1Y3RvciBzaW5jZSBAbmd0b29scy93ZWJwYWNrQDguMC40XG4gIC8vIE5vbiBASW5qZWN0YWJsZSBjbGFzc2VzIGFyZSBub3cgZ2V0dGluZyBhZGRkZWQgd2l0aCBoYXJkIHJlZmVyZW5jZSB0byB0aGUgY3RvciBwYXJhbXMgd2hpY2ggYXQgdGhlIGNsYXNzIGNyZWF0aW9uIHBvaW50IGFyZSB1bmRlZmluZWRcbiAgLy8gZm9yd2FyZFJlZigpIHdpbGwgbm90IGhlbHAgc2luY2UgaXQncyBub3QgaW5qZWN0IGJ5IGFuZ3VsYXIsIHdlIGluc3RhbnRpYXRlIHRoZSBjbGFzcy4uXG4gIC8vIHByb2JhYmx5IGR1ZSB0byBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyLWNsaS9jb21taXQvNjM5MTk4NDk5OTczZTBmNDM3ZjA1OWIzYzkzM2M3MmM3MzNkOTNkOFxuICBzdGF0aWMgY3JlYXRlPFQgPSBhbnksIFRDb2wgZXh0ZW5kcyBQYmxNZXRhQ29sdW1uIHwgUGJsQ29sdW1uID0gUGJsTWV0YUNvbHVtbj4oY29sOiBUQ29sLCBncmlkOiBfUGJsTmdyaWRDb21wb25lbnQ8VD4pOiBNZXRhQ2VsbENvbnRleHQ8VCwgVENvbD4ge1xuICAgIGNvbnN0IGluc3RhbmNlID0gbmV3IE1ldGFDZWxsQ29udGV4dDxULCBUQ29sPigpO1xuICAgIGluc3RhbmNlLmNvbCA9IGNvbDtcbiAgICBpbnN0YW5jZS5ncmlkID0gZ3JpZDtcbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxufVxuXG5leHBvcnQgY2xhc3MgUGJsQ2VsbENvbnRleHQ8VCA9IGFueT4gaW1wbGVtZW50cyBQYmxOZ3JpZENlbGxDb250ZXh0PFQ+IHtcbiAgZ2V0ICRpbXBsaWNpdCgpOiBQYmxDZWxsQ29udGV4dDxUPiB7IHJldHVybiB0aGlzOyB9XG4gIGdldCByb3coKTogVCB7IHJldHVybiB0aGlzLnJvd0NvbnRleHQuJGltcGxpY2l0OyB9O1xuICBnZXQgdmFsdWUoKTogYW55IHsgcmV0dXJuIHRoaXMuY29sLmdldFZhbHVlKHRoaXMucm93KTsgfVxuICBzZXQgdmFsdWUodjogYW55KSB7IHRoaXMuY29sLnNldFZhbHVlKHRoaXMucm93LCB2KTsgfVxuXG4gIGdldCByb3dDb250ZXh0KCk6IFBibE5ncmlkUm93Q29udGV4dDxUPiB7IHJldHVybiB0aGlzLl9yb3dDb250ZXh0OyB9XG4gIGdldCBlZGl0aW5nKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5fZWRpdGluZzsgfVxuICBnZXQgZm9jdXNlZCgpOiBib29sZWFuIHsgcmV0dXJuIHRoaXMuX2ZvY3VzZWQ7IH1cbiAgZ2V0IHNlbGVjdGVkKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5fc2VsZWN0ZWQ7IH1cblxuICByZWFkb25seSBncmlkOiBfUGJsTmdyaWRDb21wb25lbnQ8YW55PjtcbiAgcmVhZG9ubHkgaW5kZXg6IG51bWJlcjtcblxuICBwcml2YXRlIF9lZGl0aW5nID0gZmFsc2U7XG4gIHByaXZhdGUgX2ZvY3VzZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBfc2VsZWN0ZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBfZXh0ZXJuYWwgPSB7fTtcblxuICBwcml2YXRlIF9yb3dDb250ZXh0OiBQYmxSb3dDb250ZXh0PFQ+O1xuICBwdWJsaWMgY29sOiBQYmxDb2x1bW47XG4gIHByaXZhdGUgZXh0QXBpOiBQYmxOZ3JpZEV4dGVuc2lvbkFwaTxUPjtcblxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoKSB7IH1cblxuICAvLyB3b3JrYXJvdW5kLCB3ZSBuZWVkIGEgcGFyYW1ldGVyLWxlc3MgY29uc3RydWN0b3Igc2luY2UgQG5ndG9vbHMvd2VicGFja0A4LjAuNFxuICAvLyBOb24gQEluamVjdGFibGUgY2xhc3NlcyBhcmUgbm93IGdldHRpbmcgYWRkZGVkIHdpdGggaGFyZCByZWZlcmVuY2UgdG8gdGhlIGN0b3IgcGFyYW1zIHdoaWNoIGF0IHRoZSBjbGFzcyBjcmVhdGlvbiBwb2ludCBhcmUgdW5kZWZpbmVkXG4gIC8vIGZvcndhcmRSZWYoKSB3aWxsIG5vdCBoZWxwIHNpbmNlIGl0J3Mgbm90IGluamVjdCBieSBhbmd1bGFyLCB3ZSBpbnN0YW50aWF0ZSB0aGUgY2xhc3MuLlxuICAvLyBwcm9iYWJseSBkdWUgdG8gaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci1jbGkvY29tbWl0LzYzOTE5ODQ5OTk3M2UwZjQzN2YwNTliM2M5MzNjNzJjNzMzZDkzZDhcbiAgc3RhdGljIGNyZWF0ZTxUID0gYW55Pihyb3dDb250ZXh0OiBQYmxSb3dDb250ZXh0PFQ+LCBjb2w6IFBibENvbHVtbiwgZXh0QXBpOiBQYmxOZ3JpZEV4dGVuc2lvbkFwaTxUPik6IFBibENlbGxDb250ZXh0PFQ+IHtcbiAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBQYmxDZWxsQ29udGV4dDxUPigpO1xuXG4gICAgaW5zdGFuY2UuX3Jvd0NvbnRleHQgPSByb3dDb250ZXh0O1xuICAgIGluc3RhbmNlLmNvbCA9IGNvbDtcbiAgICBpbnN0YW5jZS5leHRBcGkgPSBleHRBcGk7XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhpbnN0YW5jZSwge1xuICAgICAgZ3JpZDogeyB2YWx1ZTogZXh0QXBpLmdyaWQgfSxcbiAgICAgIGluZGV4OiB7IHZhbHVlOiBleHRBcGkuZ3JpZC5jb2x1bW5BcGkuaW5kZXhPZihjb2wpIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFN0YXRlPFQgPSBhbnk+KCk6IENlbGxDb250ZXh0U3RhdGU8VD4ge1xuICAgIHJldHVybiB7IGVkaXRpbmc6IGZhbHNlLCBmb2N1c2VkOiBmYWxzZSwgc2VsZWN0ZWQ6IGZhbHNlLCBleHRlcm5hbDoge30gfTtcbiAgfVxuXG4gIGNsb25lKGNvbD86IFBibENvbHVtbik6IFBibENlbGxDb250ZXh0PFQ+IHtcbiAgICBjb25zdCBjdHggPSBQYmxDZWxsQ29udGV4dC5jcmVhdGU8VD4odGhpcy5fcm93Q29udGV4dCwgY29sIHx8IHRoaXMuY29sLCB0aGlzLmV4dEFwaSk7XG4gICAgY3R4LmZyb21TdGF0ZSh0aGlzLmdldFN0YXRlKCksIHRoaXMuX3Jvd0NvbnRleHQsIHRydWUpO1xuICAgIHJldHVybiBjdHg7XG4gIH1cblxuICBnZXRFeHRlcm5hbDxQIGV4dGVuZHMga2V5b2YgRXh0ZXJuYWxDZWxsQ29udGV4dFN0YXRlPihrZXk6IFApOiBFeHRlcm5hbENlbGxDb250ZXh0U3RhdGVbUF0ge1xuICAgIHJldHVybiB0aGlzLl9leHRlcm5hbFtrZXldO1xuICB9XG5cbiAgc2V0RXh0ZXJuYWw8UCBleHRlbmRzIGtleW9mIEV4dGVybmFsQ2VsbENvbnRleHRTdGF0ZT4oa2V5OiBQLCB2YWx1ZTogRXh0ZXJuYWxDZWxsQ29udGV4dFN0YXRlW1BdLCBzYXZlU3RhdGUgPSBmYWxzZSkge1xuICAgIHRoaXMuX2V4dGVybmFsW2tleV0gPSB2YWx1ZTtcbiAgICBpZiAoc2F2ZVN0YXRlKSB7XG4gICAgICB0aGlzLl9yb3dDb250ZXh0LnNhdmVTdGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIGdldFN0YXRlKCk6IENlbGxDb250ZXh0U3RhdGU8VD4ge1xuICAgIHJldHVybiB7XG4gICAgICBlZGl0aW5nOiB0aGlzLl9lZGl0aW5nLFxuICAgICAgZm9jdXNlZDogdGhpcy5fZm9jdXNlZCxcbiAgICAgIHNlbGVjdGVkOiB0aGlzLl9zZWxlY3RlZCxcbiAgICAgIGV4dGVybmFsOiB0aGlzLl9leHRlcm5hbCxcbiAgICB9O1xuICB9XG5cbiAgZnJvbVN0YXRlKHN0YXRlOiBDZWxsQ29udGV4dFN0YXRlPFQ+LCByb3dDb250ZXh0OiBQYmxSb3dDb250ZXh0PFQ+LCBza2lwUm93VXBkYXRlPzogYm9vbGVhbik6IHZvaWQge1xuICAgIGNvbnN0IHJlcXVpcmVzUmVzZXQgPSAhc2tpcFJvd1VwZGF0ZSAmJiB0aGlzLl9lZGl0aW5nID09PSBzdGF0ZS5lZGl0aW5nO1xuXG4gICAgdGhpcy5fcm93Q29udGV4dCA9IHJvd0NvbnRleHQ7XG4gICAgdGhpcy5fZWRpdGluZyA9IHN0YXRlLmVkaXRpbmc7XG4gICAgdGhpcy5fZm9jdXNlZCA9IHN0YXRlLmZvY3VzZWQ7XG4gICAgdGhpcy5fc2VsZWN0ZWQgPSBzdGF0ZS5zZWxlY3RlZDtcbiAgICB0aGlzLl9leHRlcm5hbCA9IHN0YXRlLmV4dGVybmFsO1xuXG4gICAgaWYgKHJlcXVpcmVzUmVzZXQpIHtcbiAgICAgIHJvd0NvbnRleHQudXBkYXRlQ2VsbCh0aGlzKTtcbiAgICB9XG4gIH1cblxuICBzdGFydEVkaXQobWFya0ZvckNoZWNrPzogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbC5lZGl0b3JUcGwgJiYgIXRoaXMuZWRpdGluZykge1xuICAgICAgdGhpcy5fZWRpdGluZyA9IHRydWU7XG4gICAgICB0aGlzLl9yb3dDb250ZXh0LnVwZGF0ZUNlbGwodGhpcyk7XG4gICAgICBpZiAobWFya0ZvckNoZWNrKSB7XG4gICAgICAgIHRoaXMuZ3JpZC5yb3dzQXBpLnN5bmNSb3dzKCdkYXRhJywgdHJ1ZSwgdGhpcy5yb3dDb250ZXh0LmluZGV4KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzdG9wRWRpdChtYXJrRm9yQ2hlY2s/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZWRpdGluZyAmJiAhdGhpcy5ncmlkLnZpZXdwb3J0LmlzU2Nyb2xsaW5nKSB7XG4gICAgICB0aGlzLl9lZGl0aW5nID0gZmFsc2U7XG4gICAgICB0aGlzLl9yb3dDb250ZXh0LnVwZGF0ZUNlbGwodGhpcyk7XG4gICAgICBpZiAobWFya0ZvckNoZWNrKSB7XG4gICAgICAgIHRoaXMuZ3JpZC5yb3dzQXBpLnN5bmNSb3dzKCdkYXRhJywgdGhpcy5yb3dDb250ZXh0LmluZGV4KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==