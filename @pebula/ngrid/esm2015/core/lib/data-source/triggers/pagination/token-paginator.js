import { BehaviorSubject } from 'rxjs';
export class PblTokenPaginator {
    constructor() {
        this.kind = 'token';
        this._perPage = 10;
        this._total = 0;
        this.onChange$ = new BehaviorSubject({ page: [null, null] });
        this.onChange = this.onChange$.asObservable();
        this.reset();
    }
    get perPage() { return this._perPage; }
    set perPage(value) {
        if (value < 1) {
            throw new Error(`Invalid total size value ${value}`);
        }
        if (this._perPage !== value) {
            const changes = { perPage: [this._perPage, this._perPage = value] };
            this.emit(changes);
        }
    }
    get page() { return this._page; }
    set page(value) {
        if (this._page !== value) {
            const idx = this._tokens.indexOf(value);
            if (idx === -1) {
                throw new Error(`Invalid page token ${value}`);
            }
            this._cursor = idx;
            const prev = this._page;
            this._page = value;
            this.emit({ page: [prev, value] });
        }
    }
    get total() { return this._total; }
    set total(value) {
        const changes = { total: [this._total, this._total = value] };
        this.emit(changes);
    }
    get totalPages() {
        return this._tokens.length;
    }
    get range() {
        if (!this._range) {
            const start = (this._cursor) * this.perPage;
            const end = Math.min(this._total, start + this.perPage);
            this._range = this.noCacheMode
                ? [0, end - start]
                : [start, end];
        }
        return this._range;
    }
    reset() {
        this._tokens = [null];
        this._cursor = 0;
        this._total = 0;
        this.page = null;
    }
    canMove(value) {
        return this._tokens.indexOf(value) > -1;
    }
    hasNext() { return this._cursor < this._tokens.length - 1; }
    hasPrev() { return this._cursor > 0; }
    move(value) { this.page = value; }
    nextPage() { this.page = this._tokens[++this._cursor]; }
    prevPage() { this.page = this._tokens[--this._cursor]; }
    addNext(value) {
        const nextPointer = this._cursor + 1;
        // if next pointer is not like what we got, set it and delete all after (invalidate them)
        if (this._tokens[nextPointer] !== value) {
            this._tokens[nextPointer] = value;
            this._tokens.splice(nextPointer + 1);
        }
    }
    emit(changes) {
        this._range = undefined;
        if (this.queuedChanges) {
            Object.assign(this.queuedChanges, changes);
        }
        else {
            this.queuedChanges = changes;
            setTimeout(() => {
                this.queuedChanges = undefined;
                this.onChange$.next(changes);
            });
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9rZW4tcGFnaW5hdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3JpZC9jb3JlL3NyYy9saWIvZGF0YS1zb3VyY2UvdHJpZ2dlcnMvcGFnaW5hdGlvbi90b2tlbi1wYWdpbmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFjLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUduRCxNQUFNLE9BQU8saUJBQWlCO0lBOEQ1QjtRQTdEUyxTQUFJLEdBQVksT0FBTyxDQUFDO1FBdUR2QixhQUFRLEdBQVcsRUFBRSxDQUFDO1FBRXRCLFdBQU0sR0FBVyxDQUFDLENBQUM7UUFLM0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLGVBQWUsQ0FBa0MsRUFBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUMsQ0FBQyxDQUFDO1FBQzVGLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUM5QyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDZixDQUFDO0lBOURELElBQUksT0FBTyxLQUFhLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDL0MsSUFBSSxPQUFPLENBQUMsS0FBYTtRQUN2QixJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUU7WUFDYixNQUFNLElBQUksS0FBSyxDQUFDLDRCQUE0QixLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQ3REO1FBRUQsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLEtBQUssRUFBRTtZQUMzQixNQUFNLE9BQU8sR0FBb0MsRUFBRSxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNyRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NB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O0lBQzlELFFBQVEsS0FBVyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTlELE9BQU8sQ0FBQyxLQUFVO1FBQ2hCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ3JDLHlGQUF5RjtRQUN6RixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEtBQUssS0FBSyxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEdBQUcsS0FBSyxDQUFDO1lBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUN0QztJQUNILENBQUM7SUFFTyxJQUFJLENBQUMsT0FBd0M7UUFDbkQsSUFBSSxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7UUFDeEIsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztTQUM1QzthQUFNO1lBQ0wsSUFBSSxDQUFDLGFBQWEsR0FBRyxPQUFPLENBQUM7WUFDN0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDZCxJQUFJLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQztnQkFDL0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDL0IsQ0FBQyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUGJsUGFnaW5hdG9yLCBQYmxQYWdpbmF0b3JDaGFuZ2VFdmVudCB9IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgUGJsVG9rZW5QYWdpbmF0b3IgaW1wbGVtZW50cyBQYmxQYWdpbmF0b3I8c3RyaW5nPiB7XG4gIHJlYWRvbmx5IGtpbmQ6ICd0b2tlbicgPSAndG9rZW4nO1xuICBub0NhY2hlTW9kZTogYm9vbGVhbjtcblxuICBnZXQgcGVyUGFnZSgpOiBudW1iZXIgeyByZXR1cm4gdGhpcy5fcGVyUGFnZTsgfVxuICBzZXQgcGVyUGFnZSh2YWx1ZTogbnVtYmVyKSB7XG4gICAgaWYgKHZhbHVlIDwgMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHRvdGFsIHNpemUgdmFsdWUgJHt2YWx1ZX1gKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fcGVyUGFnZSAhPT0gdmFsdWUpIHtcbiAgICAgIGNvbnN0IGNoYW5nZXM6IFBibFBhZ2luYXRvckNoYW5nZUV2ZW50PHN0cmluZz4gPSB7IHBlclBhZ2U6IFt0aGlzLl9wZXJQYWdlLCB0aGlzLl9wZXJQYWdlID0gdmFsdWVdIH07XG4gICAgICB0aGlzLmVtaXQoY2hhbmdlcyk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHBhZ2UoKTogc3RyaW5nIHsgcmV0dXJuIHRoaXMuX3BhZ2U7IH1cbiAgc2V0IHBhZ2UodmFsdWU6IHN0cmluZykge1xuICAgIGlmICh0aGlzLl9wYWdlICE9PSB2YWx1ZSkge1xuICAgICAgY29uc3QgaWR4ID0gdGhpcy5fdG9rZW5zLmluZGV4T2YodmFsdWUpO1xuICAgICAgaWYgKGlkeCA9PT0gLTEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBhZ2UgdG9rZW4gJHt2YWx1ZX1gKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2N1cnNvciA9IGlkeDtcbiAgICAgIGNvbnN0IHByZXYgPSB0aGlzLl9wYWdlO1xuICAgICAgdGhpcy5fcGFnZSA9IHZhbHVlO1xuICAgICAgdGhpcy5lbWl0KHsgcGFnZTogW3ByZXYsIHZhbHVlXSB9KTtcbiAgICB9XG4gIH1cblxuICBnZXQgdG90YWwoKTogbnVtYmVyIHsgcmV0dXJuIHRoaXMuX3RvdGFsOyB9XG4gIHNldCB0b3RhbCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgY29uc3QgY2hhbmdlczogUGJsUGFnaW5hdG9yQ2hhbmdlRXZlbnQ8c3RyaW5nPiA9IHsgdG90YWw6IFt0aGlzLl90b3RhbCwgdGhpcy5fdG90YWwgPSB2YWx1ZV0gfTtcbiAgICB0aGlzLmVtaXQoY2hhbmdlcyk7XG4gIH1cblxuICBnZXQgdG90YWxQYWdlcygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl90b2tlbnMubGVuZ3RoO1xuICB9XG5cbiAgZ2V0IHJhbmdlKCk6IFtudW1iZXIsIG51bWJlcl0ge1xuICAgIGlmICghdGhpcy5fcmFuZ2UpIHtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gKHRoaXMuX2N1cnNvcikgKiB0aGlzLnBlclBhZ2U7XG4gICAgICBjb25zdCBlbmQgPSBNYXRoLm1pbih0aGlzLl90b3RhbCwgc3RhcnQgKyB0aGlzLnBlclBhZ2UpO1xuICAgICAgdGhpcy5fcmFuZ2UgPSB0aGlzLm5vQ2FjaGVNb2RlXG4gICAgICAgID8gWyAwLCBlbmQgLSBzdGFydCBdXG4gICAgICAgIDogWyBzdGFydCwgZW5kIF1cbiAgICAgIDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3JhbmdlO1xuICB9XG5cbiAgcmVhZG9ubHkgb25DaGFuZ2U6IE9ic2VydmFibGU8UGJsUGFnaW5hdG9yQ2hhbmdlRXZlbnQ8c3RyaW5nPj47XG4gIHByb3RlY3RlZCBvbkNoYW5nZSQ6IEJlaGF2aW9yU3ViamVjdDxQYmxQYWdpbmF0b3JDaGFuZ2VFdmVudDxzdHJpbmc+PjtcbiAgcHJvdGVjdGVkIHF1ZXVlZENoYW5nZXM6IFBibFBhZ2luYXRvckNoYW5nZUV2ZW50PHN0cmluZz4gfCB1bmRlZmluZWQ7XG4gIHByb3RlY3RlZCBfcmFuZ2U6IFtudW1iZXIsIG51bWJlcl07XG4gIHByb3RlY3RlZCBfcGVyUGFnZTogbnVtYmVyID0gMTA7XG4gIHByb3RlY3RlZCBfcGFnZTogYW55O1xuICBwcm90ZWN0ZWQgX3RvdGFsOiBudW1iZXIgPSAwO1xuICBwcm90ZWN0ZWQgX3Rva2VuczogYW55W107XG4gIHByb3RlY3RlZCBfY3Vyc29yOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5vbkNoYW5nZSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFBibFBhZ2luYXRvckNoYW5nZUV2ZW50PHN0cmluZz4+KHtwYWdlOiBbbnVsbCwgbnVsbF19KTtcbiAgICB0aGlzLm9uQ2hhbmdlID0gdGhpcy5vbkNoYW5nZSQuYXNPYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5yZXNldCgpO1xuICB9XG5cbiAgcmVzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5fdG9rZW5zID0gW251bGxdO1xuICAgIHRoaXMuX2N1cnNvciA9IDA7XG4gICAgdGhpcy5fdG90YWwgPSAwO1xuICAgIHRoaXMucGFnZSA9IG51bGw7XG4gIH1cblxuICBjYW5Nb3ZlKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fdG9rZW5zLmluZGV4T2YodmFsdWUpID4gLTE7XG4gIH1cblxuICBoYXNOZXh0KCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5fY3Vyc29yIDwgdGhpcy5fdG9rZW5zLmxlbmd0aCAtIDE7IH1cbiAgaGFzUHJldigpOiBib29sZWFuIHsgcmV0dXJuIHRoaXMuX2N1cnNvciA+IDA7IH1cblxuICBtb3ZlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHsgdGhpcy5wYWdlID0gdmFsdWU7IH1cbiAgbmV4dFBhZ2UoKTogdm9pZCB7IHRoaXMucGFnZSA9IHRoaXMuX3Rva2Vuc1srK3RoaXMuX2N1cnNvcl07IH1cbiAgcHJldlBhZ2UoKTogdm9pZCB7IHRoaXMucGFnZSA9IHRoaXMuX3Rva2Vuc1stLXRoaXMuX2N1cnNvcl07IH1cblxuICBhZGROZXh0KHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBuZXh0UG9pbnRlciA9IHRoaXMuX2N1cnNvciArIDE7XG4gICAgLy8gaWYgbmV4dCBwb2ludGVyIGlzIG5vdCBsaWtlIHdoYXQgd2UgZ290LCBzZXQgaXQgYW5kIGRlbGV0ZSBhbGwgYWZ0ZXIgKGludmFsaWRhdGUgdGhlbSlcbiAgICBpZiAodGhpcy5fdG9rZW5zW25leHRQb2ludGVyXSAhPT0gdmFsdWUpIHtcbiAgICAgIHRoaXMuX3Rva2Vuc1tuZXh0UG9pbnRlcl0gPSB2YWx1ZTtcbiAgICAgIHRoaXMuX3Rva2Vucy5zcGxpY2UobmV4dFBvaW50ZXIgKyAxKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGVtaXQoY2hhbmdlczogUGJsUGFnaW5hdG9yQ2hhbmdlRXZlbnQ8c3RyaW5nPik6IHZvaWQge1xuICAgIHRoaXMuX3JhbmdlID0gdW5kZWZpbmVkO1xuICAgIGlmICh0aGlzLnF1ZXVlZENoYW5nZXMpIHtcbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5xdWV1ZWRDaGFuZ2VzLCBjaGFuZ2VzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5xdWV1ZWRDaGFuZ2VzID0gY2hhbmdlcztcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnF1ZXVlZENoYW5nZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMub25DaGFuZ2UkLm5leHQoY2hhbmdlcyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==