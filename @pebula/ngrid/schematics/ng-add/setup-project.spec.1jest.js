"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const testing_1 = require("@angular-devkit/schematics/testing");
const workspace_1 = require("@schematics/angular/utility/workspace");
const messages = require("./messages");
const testing_2 = require("../utils/testing");
['app', 'second-app'].forEach(projectName => {
    describe(`ng-add-project-setup, 'project=${projectName}'`, () => {
        let runner;
        let log = [];
        function createAppWithOptions(appOptions = {}) {
            return tslib_1.__awaiter(this, void 0, void 0, function* () {
                // 'app' is the default application, so we're not passing '--project' option
                const options = { project: projectName };
                let tree = yield testing_2.createTestApp(runner, appOptions);
                tree = yield runner.runSchematicAsync('ng-add-setup-project', options, tree).toPromise();
                const workspace = yield workspace_1.getWorkspace(tree);
                const project = workspace.projects.get(projectName);
                return { tree, project: project };
            });
        }
        beforeEach(() => {
            log = [];
            runner = new testing_1.SchematicTestRunner('schematics', require.resolve('../collection.json'));
            runner.logger.subscribe(({ message }) => log.push(message));
        });
        it(`should add '@angular/localize' polyfill`, () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            let tree = yield testing_2.createTestApp(runner);
            const polyfillFilePath = `projects/${projectName}/src/polyfills.ts`;
            expect(tree.read(polyfillFilePath).toString()).not.toContain('@angular/localize');
            tree = yield runner.runSchematicAsync('ng-add-setup-project', projectName ? { project: projectName } : {}, tree)
                .toPromise();
            expect(tree.read(polyfillFilePath).toString()).toContain('@angular/localize');
        }));
        it(`should add 'bootstrap.min.css' to 'angular.json' by default`, () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const { project } = yield createAppWithOptions();
            const targetOptions = project.targets.get('build').options;
            expect(targetOptions.styles).toContain('node_modules/bootstrap/dist/css/bootstrap.min.css');
        }));
        it(`should patch 'style.sass' when using SASS styles`, () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const { tree } = yield createAppWithOptions({ style: 'sass' });
            const expectedStylesPath = `projects/${projectName}/src/styles.sass`;
            const stylesFile = tree.read(expectedStylesPath).toString();
            expect(stylesFile).toContain(`@import '~bootstrap/scss/bootstrap'`);
            expect(stylesFile).not.toContain(`@import '~bootstrap/scss/bootstrap;'`);
        }));
        it(`should patch 'style.scss' when using SCSS styles`, () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const { tree } = yield createAppWithOptions({ style: 'scss' });
            const expectedStylesPath = `projects/${projectName}/src/styles.scss`;
            const stylesFile = tree.read(expectedStylesPath).toString();
            expect(stylesFile).toContain(`@import '~bootstrap/scss/bootstrap';`);
        }));
        it(`should add 'bootstrap.min.css' to 'angular.json' if style system is unsupported`, () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const { project } = yield createAppWithOptions({ style: 'less' });
            const targetOptions = project.targets.get('build').options;
            expect(targetOptions.styles).toContain('node_modules/bootstrap/dist/css/bootstrap.min.css');
            expect(log).toEqual([messages.unsupportedStyles(`projects/${projectName}/src/styles.less`)]);
        }));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0dXAtcHJvamVjdC5zcGVjLjFqZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3JpZC9zY2hlbWF0aWNzL25nLWFkZC9zZXR1cC1wcm9qZWN0LnNwZWMuMWplc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsZ0VBQXFGO0FBQ3JGLHFFQUFtRTtBQUduRSx1Q0FBdUM7QUFDdkMsOENBQStDO0FBRS9DLENBQUMsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsRUFBRTtJQUMxQyxRQUFRLENBQUMsa0NBQWtDLFdBQVcsR0FBRyxFQUFFLEdBQUcsRUFBRTtRQUU5RCxJQUFJLE1BQTJCLENBQUM7UUFDaEMsSUFBSSxHQUFHLEdBQWEsRUFBRSxDQUFDO1FBRXZCLFNBQWUsb0JBQW9CLENBQUMsVUFBVSxHQUFHLEVBQUU7O2dCQUVqRCw0RUFBNEU7Z0JBQzVFLE1BQU0sT0FBTyxHQUFXLEVBQUMsT0FBTyxFQUFFLFdBQVcsRUFBQyxDQUFDO2dCQUMvQyxJQUFJLElBQUksR0FBRyxNQUFNLHVCQUFhLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDO2dCQUNuRCxJQUFJLEdBQUcsTUFBTSxNQUFNLENBQUMsaUJBQWlCLENBQUMsc0JBQXNCLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUN6RixNQUFNLFNBQVMsR0FBRyxNQUFNLHdCQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzNDLE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO2dCQUNwRCxPQUFPLEVBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxPQUFjLEVBQUMsQ0FBQztZQUN6QyxDQUFDO1NBQUE7UUFFRCxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsR0FBRyxHQUFHLEVBQUUsQ0FBQztZQUNULE1B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QUssRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO1lBQzlELE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBRyxDQUFDLE9BQU8sQ0FBQztZQUU3RCxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxtREFBbUQsQ0FBQyxDQUFDO1lBQzVGLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsWUFBWSxXQUFXLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9GLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTY2hlbWF0aWNUZXN0UnVubmVyLCBVbml0VGVzdFRyZWV9IGZyb20gJ0Bhbmd1bGFyLWRldmtpdC9zY2hlbWF0aWNzL3Rlc3RpbmcnO1xuaW1wb3J0IHtnZXRXb3Jrc3BhY2V9IGZyb20gJ0BzY2hlbWF0aWNzL2FuZ3VsYXIvdXRpbGl0eS93b3Jrc3BhY2UnO1xuaW1wb3J0IHt3b3Jrc3BhY2VzfSBmcm9tICdAYW5ndWxhci1kZXZraXQvY29yZSc7XG5pbXBvcnQge1NjaGVtYX0gZnJvbSAnLi9zY2hlbWEnO1xuaW1wb3J0ICogYXMgbWVzc2FnZXMgZnJvbSAnLi9tZXNzYWdlcyc7XG5pbXBvcnQge2NyZWF0ZVRlc3RBcHB9IGZyb20gJy4uL3V0aWxzL3Rlc3RpbmcnO1xuXG5bJ2FwcCcsICdzZWNvbmQtYXBwJ10uZm9yRWFjaChwcm9qZWN0TmFtZSA9PiB7XG4gIGRlc2NyaWJlKGBuZy1hZGQtcHJvamVjdC1zZXR1cCwgJ3Byb2plY3Q9JHtwcm9qZWN0TmFtZX0nYCwgKCkgPT4ge1xuXG4gICAgbGV0IHJ1bm5lcjogU2NoZW1hdGljVGVzdFJ1bm5lcjtcbiAgICBsZXQgbG9nOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXBwV2l0aE9wdGlvbnMoYXBwT3B0aW9ucyA9IHt9KTpcbiAgICAgICAgUHJvbWlzZTx7IHRyZWU6IFVuaXRUZXN0VHJlZSwgcHJvamVjdDogd29ya3NwYWNlcy5Qcm9qZWN0RGVmaW5pdGlvbiB9PiB7XG4gICAgICAvLyAnYXBwJyBpcyB0aGUgZGVmYXVsdCBhcHBsaWNhdGlvbiwgc28gd2UncmUgbm90IHBhc3NpbmcgJy0tcHJvamVjdCcgb3B0aW9uXG4gICAgICBjb25zdCBvcHRpb25zOiBTY2hlbWEgPSB7cHJvamVjdDogcHJvamVjdE5hbWV9O1xuICAgICAgbGV0IHRyZWUgPSBhd2FpdCBjcmVhdGVUZXN0QXBwKHJ1bm5lciwgYXBwT3B0aW9ucyk7XG4gICAgICB0cmVlID0gYXdhaXQgcnVubmVyLnJ1blNjaGVtYXRpY0FzeW5jKCduZy1hZGQtc2V0dXAtcHJvamVjdCcsIG9wdGlvbnMsIHRyZWUpLnRvUHJvbWlzZSgpO1xuICAgICAgY29uc3Qgd29ya3NwYWNlID0gYXdhaXQgZ2V0V29ya3NwYWNlKHRyZWUpO1xuICAgICAgY29uc3QgcHJvamVjdCA9IHdvcmtzcGFjZS5wcm9qZWN0cy5nZXQocHJvamVjdE5hbWUpO1xuICAgICAgcmV0dXJuIHt0cmVlLCBwcm9qZWN0OiBwcm9qZWN0IGFzIGFueX07XG4gICAgfVxuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBsb2cgPSBbXTtcbiAgICAgIHJ1bm5lciA9IG5ldyBTY2hlbWF0aWNUZXN0UnVubmVyKCdzY2hlbWF0aWNzJywgcmVxdWlyZS5yZXNvbHZlKCcuLi9jb2xsZWN0aW9uLmpzb24nKSk7XG4gICAgICBydW5uZXIubG9nZ2VyLnN1YnNjcmliZSgoe21lc3NhZ2V9KSA9PiBsb2cucHVzaChtZXNzYWdlKSk7XG4gICAgfSk7XG5cbiAgICBpdChgc2hvdWxkIGFkZCAnQGFuZ3VsYXIvbG9jYWxpemUnIHBvbHlmaWxsYCwgYXN5bmMoKSA9PiB7XG4gICAgICBsZXQgdHJlZSA9IGF3YWl0IGNyZWF0ZVRlc3RBcHAocnVubmVyKTtcbiAgICAgIGNvbnN0IHBvbHlmaWxsRmlsZVBhdGggPSBgcHJvamVjdHMvJHtwcm9qZWN0TmFtZX0vc3JjL3BvbHlmaWxscy50c2A7XG5cbiAgICAgIGV4cGVjdCh0cmVlLnJlYWQocG9seWZpbGxGaWxlUGF0aCkgIS50b1N0cmluZygpKS5ub3QudG9Db250YWluKCdAYW5ndWxhci9sb2NhbGl6ZScpO1xuXG4gICAgICB0cmVlID0gYXdhaXQgcnVubmVyLnJ1blNjaGVtYXRpY0FzeW5jKCduZy1hZGQtc2V0dXAtcHJvamVjdCcsIHByb2plY3ROYW1lID8ge3Byb2plY3Q6IHByb2plY3ROYW1lfSA6IHt9LCB0cmVlKVxuICAgICAgICAgICAgICAgICAudG9Qcm9taXNlKCk7XG4gICAgICBleHBlY3QodHJlZS5yZWFkKHBvbHlmaWxsRmlsZVBhdGgpICEudG9TdHJpbmcoKSkudG9Db250YWluKCdAYW5ndWxhci9sb2NhbGl6ZScpO1xuICAgIH0pO1xuXG4gICAgaXQoYHNob3VsZCBhZGQgJ2Jvb3RzdHJhcC5taW4uY3NzJyB0byAnYW5ndWxhci5qc29uJyBieSBkZWZhdWx0YCwgYXN5bmMoKSA9PiB7XG4gICAgICBjb25zdCB7cHJvamVjdH0gPSBhd2FpdCBjcmVhdGVBcHBXaXRoT3B0aW9ucygpO1xuICAgICAgY29uc3QgdGFyZ2V0T3B0aW9ucyA9IHByb2plY3QudGFyZ2V0cy5nZXQoJ2J1aWxkJykgIS5vcHRpb25zO1xuXG4gICAgICBleHBlY3QodGFyZ2V0T3B0aW9ucy5zdHlsZXMpLnRvQ29udGFpbignbm9kZV9tb2R1bGVzL2Jvb3RzdHJhcC9kaXN0L2Nzcy9ib290c3RyYXAubWluLmNzcycpO1xuICAgIH0pO1xuXG4gICAgaXQoYHNob3VsZCBwYXRjaCAnc3R5bGUuc2Fzcycgd2hlbiB1c2luZyBTQVNTIHN0eWxlc2AsIGFzeW5jKCkgPT4ge1xuICAgICAgY29uc3Qge3RyZWV9ID0gYXdhaXQgY3JlYXRlQXBwV2l0aE9wdGlvbnMoe3N0eWxlOiAnc2Fzcyd9KTtcblxuICAgICAgY29uc3QgZXhwZWN0ZWRTdHlsZXNQYXRoID0gYHByb2plY3RzLyR7cHJvamVjdE5hbWV9L3NyYy9zdHlsZXMuc2Fzc2A7XG4gICAgICBjb25zdCBzdHlsZXNGaWxlID0gdHJlZS5yZWFkKGV4cGVjdGVkU3R5bGVzUGF0aCkgIS50b1N0cmluZygpO1xuXG4gICAgICBleHBlY3Qoc3R5bGVzRmlsZSkudG9Db250YWluKGBAaW1wb3J0ICd+Ym9vdHN0cmFwL3Njc3MvYm9vdHN0cmFwJ2ApO1xuICAgICAgZXhwZWN0KHN0eWxlc0ZpbGUpLm5vdC50b0NvbnRhaW4oYEBpbXBvcnQgJ35ib290c3RyYXAvc2Nzcy9ib290c3RyYXA7J2ApO1xuICAgIH0pO1xuXG4gICAgaXQoYHNob3VsZCBwYXRjaCAnc3R5bGUuc2Nzcycgd2hlbiB1c2luZyBTQ1NTIHN0eWxlc2AsIGFzeW5jKCkgPT4ge1xuICAgICAgY29uc3Qge3RyZWV9ID0gYXdhaXQgY3JlYXRlQXBwV2l0aE9wdGlvbnMoe3N0eWxlOiAnc2Nzcyd9KTtcblxuICAgICAgY29uc3QgZXhwZWN0ZWRTdHlsZXNQYXRoID0gYHByb2plY3RzLyR7cHJvamVjdE5hbWV9L3NyYy9zdHlsZXMuc2Nzc2A7XG4gICAgICBjb25zdCBzdHlsZXNGaWxlID0gdHJlZS5yZWFkKGV4cGVjdGVkU3R5bGVzUGF0aCkgIS50b1N0cmluZygpO1xuXG4gICAgICBleHBlY3Qoc3R5bGVzRmlsZSkudG9Db250YWluKGBAaW1wb3J0ICd+Ym9vdHN0cmFwL3Njc3MvYm9vdHN0cmFwJztgKTtcbiAgICB9KTtcblxuICAgIGl0KGBzaG91bGQgYWRkICdib290c3RyYXAubWluLmNzcycgdG8gJ2FuZ3VsYXIuanNvbicgaWYgc3R5bGUgc3lzdGVtIGlzIHVuc3VwcG9ydGVkYCwgYXN5bmMoKSA9PiB7XG4gICAgICBjb25zdCB7cHJvamVjdH0gPSBhd2FpdCBjcmVhdGVBcHBXaXRoT3B0aW9ucyh7c3R5bGU6ICdsZXNzJ30pO1xuICAgICAgY29uc3QgdGFyZ2V0T3B0aW9ucyA9IHByb2plY3QudGFyZ2V0cy5nZXQoJ2J1aWxkJykgIS5vcHRpb25zO1xuXG4gICAgICBleHBlY3QodGFyZ2V0T3B0aW9ucy5zdHlsZXMpLnRvQ29udGFpbignbm9kZV9tb2R1bGVzL2Jvb3RzdHJhcC9kaXN0L2Nzcy9ib290c3RyYXAubWluLmNzcycpO1xuICAgICAgZXhwZWN0KGxvZykudG9FcXVhbChbbWVzc2FnZXMudW5zdXBwb3J0ZWRTdHlsZXMoYHByb2plY3RzLyR7cHJvamVjdE5hbWV9L3NyYy9zdHlsZXMubGVzc2ApXSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=