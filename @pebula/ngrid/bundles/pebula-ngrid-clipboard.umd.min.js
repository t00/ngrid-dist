!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("@angular/core"),require("@angular/common"),require("@pebula/ngrid"),require("@pebula/ngrid/target-events")):"function"==typeof define&&define.amd?define("@pebula/ngrid/clipboard",["exports","rxjs/operators","@angular/core","@angular/common","@pebula/ngrid","@pebula/ngrid/target-events"],t):t(((e=e||self).pebula=e.pebula||{},e.pebula.ngrid=e.pebula.ngrid||{},e.pebula.ngrid.clipboard={}),e.rxjs.operators,e.ng.core,e.ng.common,e.pebula.ngrid,e.pebula.ngrid["target-events"])}(this,(function(e,t,r,n,o,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function a(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}var l=function(){function e(e){this._document=e}return e.prototype.copy=function(e){var t=this.beginCopy(e),r=t.copy();return t.destroy(),r},e.prototype.beginCopy=function(e){return new u(e,this._document)},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:[n.DOCUMENT]}]}]},e.ɵprov=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(n.DOCUMENT))},token:e,providedIn:"root"}),e}();var u=function(){function e(e,t){this._document=t;var r=this._textarea=this._document.createElement("textarea");r.setAttribute("style","opacity: 0;"),r.setAttribute("aria-hidden","true"),r.value=e,this._document.body.appendChild(r)}return e.prototype.copy=function(){var e=this._textarea,t=!1;try{if(e){var r=document.activeElement;e.select(),t=this._document.execCommand("copy"),r instanceof HTMLElement&&r.focus()}}catch(e){}return t},e.prototype.destroy=function(){this._textarea&&(this._document.body.removeChild(this._textarea),this._textarea=void 0)},e}();var c=/^mac/.test(navigator.platform.toLowerCase()),p=function(){function e(e,t,r){this.grid=e,this.injector=t,this.pluginCtrl=r,this.config=t.get(o.PblNgridConfigService),this.clipboard=t.get(l),this.init()}return e.create=function(t,r){return new e(t,r,o.PblNgridPluginController.find(t))},e.prototype.ngOnDestroy=function(){o.utils.unrx.kill(this),this._removePlugin(this.grid)},e.prototype.isCopyEvent=function(e){return!!(e instanceof KeyboardEvent&&"c"===e.key&&(!c&&e.ctrlKey||c&&e.metaKey))},e.prototype.doCopy=function(){var e=this,t=this.config.get("clipboard",{}),r=t.cellSeparator,n=t.rowSeparator,o=this.getSelectedRowData(this.grid),i=o.rows,a=o.minIndex;this.clipboard.copy(i.map((function(t){return t.slice(a).join(e.clpCellSep||r||"\t")})).join(this.clpRowSep||n||"\n"))},e.prototype.getSelectedRowData=function(e){var t,r,n=e.columnApi,o=e.contextApi,i=new Map,l=Number.MAX_SAFE_INTEGER;try{for(var u=a(o.selectedCells),c=u.next();!c.done;c=u.next()){var p=c.value,d=n.columns[p.colIndex];if(d){var s=n.renderIndexOf(d);if(s>-1){var g=o.findRowInCache(p.rowIdent).dataIndex,f=d.getValue(e.ds.source[g]),y=i.get(p.rowIdent)||[];y[s]=f,i.set(p.rowIdent,y),l=Math.min(l,s)}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}var b=Array.from(i.entries());return b.sort((function(e,t){return o.findRowInCache(e[0]).dataIndex<o.findRowInCache(t[0]).dataIndex?-1:1})),{minIndex:l,rows:b.map((function(e){return e[1]}))}},e.prototype.init=function(){var e=this;this._removePlugin=this.pluginCtrl.setPlugin("clipboard",this),this.pluginCtrl.hasPlugin("targetEvents")||this.pluginCtrl.createPlugin("targetEvents"),this.pluginCtrl.getPlugin("targetEvents").keyDown.pipe(t.filter((function(t){return e.isCopyEvent(t.source)})),o.utils.unrx(this)).subscribe((function(t){return e.doCopy()}))},e.decorators=[{type:r.Directive,args:[{selector:"pbl-ngrid[clipboard]",exportAs:"pblNgridClipboard"}]}],e.ctorParameters=function(){return[{type:o.PblNgridComponent},{type:r.Injector},{type:o.PblNgridPluginController}]},e.propDecorators={clpCellSep:[{type:r.Input}],clpRowSep:[{type:r.Input}]},e}();var d=function(){function e(e,r){e||o.PblNgridPluginController.created.subscribe((function(e){if(!0===r.get("clipboard",{}).autoEnable){var n=e.controller;n.events.pipe(t.filter((function(e){return"onInit"===e.kind})),t.first()).subscribe((function(e){n.hasPlugin("clipboard")||n.createPlugin("clipboard")}))}}))}return e.NGRID_PLUGIN=o.ngridPlugin({id:"clipboard",factory:"create"},p),e.decorators=[{type:r.NgModule,args:[{imports:[n.CommonModule,o.PblNgridModule,i.PblNgridTargetEventsModule],declarations:[p],exports:[p]}]}],e.ctorParameters=function(){return[{type:e,decorators:[{type:r.Optional},{type:r.SkipSelf}]},{type:o.PblNgridConfigService}]},e}();e.PLUGIN_KEY="clipboard",e.PblNgridClipboardPlugin=p,e.PblNgridClipboardPluginModule=d,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pebula-ngrid-clipboard.umd.min.js.map