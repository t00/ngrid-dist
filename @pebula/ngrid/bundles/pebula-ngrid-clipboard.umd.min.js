!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("@angular/core"),require("@angular/common"),require("@pebula/utils"),require("@pebula/ngrid"),require("@pebula/ngrid/target-events")):"function"==typeof define&&define.amd?define("@pebula/ngrid/clipboard",["exports","rxjs/operators","@angular/core","@angular/common","@pebula/utils","@pebula/ngrid","@pebula/ngrid/target-events"],t):t(((e=e||self).pebula=e.pebula||{},e.pebula.ngrid=e.pebula.ngrid||{},e.pebula.ngrid.clipboard={}),e.rxjs.operators,e.ng.core,e.ng.common,e.pebula.utils,e.pebula.ngrid,e.pebula.ngrid["target-events"])}(this,function(e,t,r,n,o,i,a){"use strict";function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}var u=function(){function e(e){this._document=e}return e.prototype.copy=function(e){var t=this.beginCopy(e),r=t.copy();return t.destroy(),r},e.prototype.beginCopy=function(e){return new p(e,this._document)},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:[n.DOCUMENT]}]}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(n.DOCUMENT))},token:e,providedIn:"root"}),e}();var p=function(){function e(e,t){this._document=t;var r=this._textarea=this._document.createElement("textarea");r.setAttribute("style","opacity: 0;"),r.setAttribute("aria-hidden","true"),r.value=e,this._document.body.appendChild(r)}return e.prototype.copy=function(){var e=this._textarea,t=!1;try{if(e){var r=document.activeElement;e.select(),t=this._document.execCommand("copy"),r instanceof HTMLElement&&r.focus()}}catch(e){}return t},e.prototype.destroy=function(){this._textarea&&(this._document.body.removeChild(this._textarea),this._textarea=void 0)},e}();var s=/^mac/.test(navigator.platform.toLowerCase()),d="clipboard",f=function(){function e(e,t,r){this.grid=e,this.injector=t,this.pluginCtrl=r,this.config=t.get(i.PblNgridConfigService),this.clipboard=t.get(u),this.init()}var n;return n=e,e.create=function(e,t){var r=i.PblNgridPluginController.find(e);return new n(e,t,r)},e.prototype.ngOnDestroy=function(){this._removePlugin(this.grid)},e.prototype.isCopyEvent=function(e){return!!(e instanceof KeyboardEvent&&"c"===e.key&&(!s&&e.ctrlKey||s&&e.metaKey))},e.prototype.doCopy=function(){var e=this,t=this.config.get("clipboard",{}),r=t.cellSeparator,n=t.rowSeparator,o=this.getSelectedRowData(this.grid),i=o.rows,a=o.minIndex;this.clipboard.copy(i.map(function(t){return t.slice(a).join(e.clpCellSep||r||"\t")}).join(this.clpRowSep||n||"\n"))},e.prototype.getSelectedRowData=function(e){var t,r,n=e.columnApi,o=e.contextApi,i=new Map,a=Number.MAX_SAFE_INTEGER;try{for(var l=c(o.selectedCells),u=l.next();!u.done;u=l.next()){var p=u.value,s=n.columns[p.colIndex];if(s){var d=n.renderIndexOf(s);if(d>-1){var f=o.findRowInCache(p.rowIdent).dataIndex,g=s.getValue(e.ds.source[f]),y=i.get(p.rowIdent)||[];y[d]=g,i.set(p.rowIdent,y),a=Math.min(a,d)}}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return{minIndex:a,rows:Array.from(i.values())}},e.prototype.init=function(){var e=this;this._removePlugin=this.pluginCtrl.setPlugin(d,this),this.pluginCtrl.hasPlugin("targetEvents")||this.pluginCtrl.createPlugin("targetEvents"),this.pluginCtrl.getPlugin("targetEvents").keyDown.pipe(t.filter(function(t){return e.isCopyEvent(t.source)}),o.UnRx(this)).subscribe(function(t){return e.doCopy()})},e.decorators=[{type:r.Directive,args:[{selector:"pbl-ngrid[clipboard]",exportAs:"pblNgridClipboard"}]}],e.ctorParameters=function(){return[{type:i.PblNgridComponent},{type:r.Injector},{type:i.PblNgridPluginController}]},e.propDecorators={clpCellSep:[{type:r.Input}],clpRowSep:[{type:r.Input}]},e=n=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}([i.TablePlugin({id:d,factory:"create"}),o.UnRx(),l("design:paramtypes",[i.PblNgridComponent,r.Injector,i.PblNgridPluginController])],e)}();var g=function(){function e(e,r){e||i.PblNgridPluginController.created.subscribe(function(e){if(!0===r.get(d,{}).autoEnable){var n=e.controller;n.events.pipe(t.filter(function(e){return"onInit"===e.kind}),t.first()).subscribe(function(e){n.hasPlugin(d)||n.createPlugin(d)})}})}return e.decorators=[{type:r.NgModule,args:[{imports:[n.CommonModule,i.PblNgridModule,a.PblNgridTargetEventsModule],declarations:[f],exports:[f]}]}],e.ctorParameters=function(){return[{type:e,decorators:[{type:r.Optional},{type:r.SkipSelf}]},{type:i.PblNgridConfigService}]},e}();e.PLUGIN_KEY=d,e.PblNgridClipboardPlugin=f,e.PblNgridClipboardPluginModule=g,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=pebula-ngrid-clipboard.umd.min.js.map