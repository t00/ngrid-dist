!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@pebula/ngrid"),require("rxjs/operators"),require("@angular/cdk/coercion"),require("rxjs")):"function"==typeof define&&define.amd?define("@pebula/ngrid/transpose",["exports","@angular/core","@angular/common","@pebula/ngrid","rxjs/operators","@angular/cdk/coercion","rxjs"],t):t(((e=e||self).pebula=e.pebula||{},e.pebula.ngrid=e.pebula.ngrid||{},e.pebula.ngrid.transpose={}),e.ng.core,e.ng.common,e.pebula.ngrid,e.rxjs.operators,e.ng.cdk.coercion,e.rxjs)}(this,(function(e,t,r,i,o,n,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function a(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,o,n=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}var l=Symbol("LOCAL_COLUMN_DEF"),d={},c=function(){function e(e,t,r,i){this.grid=e,this.pluginCtrl=t,this.updateColumns=r,this.sourceFactoryWrapper=i,this.init(),e.columns&&e.columnApi.visibleColumns.length>0&&this.onInvalidateHeaders(),this.onDataSource(this.grid.ds)}return e.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,i.utils.unrx.kill(this,this.grid),this.grid.showHeader=this.headerRow,this.grid.columns=this.columnsInput,e&&(this.grid.invalidateColumns(),this.grid.ds.refresh(d)))},e.prototype.init=function(){var e=this;this.headerRow=this.grid.showHeader,this.grid.showHeader=!1,this.pluginCtrl.events.pipe(i.utils.unrx(this,this.grid)).subscribe((function(t){return"onInvalidateHeaders"===t.kind&&e.onInvalidateHeaders()})),this.pluginCtrl.events.pipe(i.utils.unrx(this,this.grid)).subscribe((function(t){return"onDataSource"===t.kind&&e.onDataSource(t.curr)}))},e.prototype.onInvalidateHeaders=function(){this.grid.columns[l]||(this.columnsInput=this.grid.columns,this.storeColumns=this.grid.columnApi.visibleColumns,this.updateColumns())},e.prototype.onDataSource=function(e){var t=this;this.unPatchDataSource(),e&&(this.ds=e,this.dsSourceFactory=e.adapter.sourceFactory,this.ds.adapter.sourceFactory=function(e){var r=e.data.changed&&e.data.curr===d?t.ds.source:t.dsSourceFactory(e);return!1===r?r:t.destroyed?(t.unPatchDataSource(),t.rawSource):(s.isObservable(r)?r:Array.isArray(r)?s.of(r):s.from(r)).pipe(o.tap((function(e){return t.rawSource=e})),o.map(t.sourceFactoryWrapper))})},e.prototype.unPatchDataSource=function(){this.ds&&(this.ds.adapter.sourceFactory=this.dsSourceFactory,this.ds=this.dsSourceFactory=void 0)},e}();var p=Symbol("TRANSFORM_ROW_REF");function h(e){return e.getValue(this.data[p])}function f(e,t){var r;return{prop:"__transform_item_"+t+"__",data:(r={},r[p]=e,r)}}var g={prop:"__transpose__",css:"pbl-ngrid-header-cell pbl-ngrid-transposed-header-cell"},y=function(){function e(e,t,r){var n=this;this.grid=e,this.pluginCtrl=t,this._header=g,this._removePlugin=t.setPlugin("transpose",this);var s=r.get("transposePlugin");s&&(this.header=s.header,this.defaultCol=s.defaultCol||{},this.matchTemplates=s.matchTemplates||!1),t.events.pipe(o.filter((function(e){return"onInit"===e.kind})),o.take(1),i.utils.unrx(this,this.grid)).subscribe((function(e){void 0!==n.enabled&&n.updateState(void 0,n.enabled)}))}return Object.defineProperty(e.prototype,"transpose",{get:function(){return this.enabled},set:function(e){(e=n.coerceBooleanProperty(e))!==this.enabled&&this.grid.isInit&&this.updateState(this.enabled,e),this.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"header",{set:function(e){this._header=Object.assign({},g,e||{})},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this._removePlugin(this.grid),this.disable(!1),i.utils.unrx.kill(this)},e.prototype.disable=function(e){if(this.gridState){var t=this.gridState;this.columns=this.selfColumn=this.gridState=this.columns=this.selfColumn=void 0,t.destroy(e)}},e.prototype.enable=function(e){var t=this;void 0===e&&(e=!1),this.gridState&&this.disable(!1);this.gridState=new c(this.grid,this.pluginCtrl,(function(){return t.updateColumns(t.grid.columnApi.visibleColumns)}),(function(e){var r,o,s,d,c;if(e){var p=t.grid.columns=(r=i.columnFactory().default(t.defaultCol||{})).table.apply(r,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}([t.selfColumn],e.map(f))).build(),g=t.gridState.columnsInput;p.header=g.header,p.headerGroup=g.headerGroup,p.footer=g.footer,p[l]=!0,t.grid.invalidateColumns();var y,m=n.coerceBooleanProperty(t.matchTemplates),b=t._header.prop,v=["type"];m&&v.push("cellTpl");try{for(var C=a(t.grid.columnApi.visibleColumns),S=C.next();!S.done;S=C.next()){var x=S.value;if(x.orgProp===b)x.getValue=function(e){return y=e,e.label};else{x.getValue=h;var P=function(e){Object.defineProperty(x,e,{configurable:!0,get:function(){return y&&y[e]},set:function(e){}})};try{for(var _=(d=void 0,a(v)),I=_.next();!I.done;I=_.next()){P(I.value)}}catch(e){d={error:e}}finally{try{I&&!I.done&&(c=_.return)&&c.call(_)}finally{if(d)throw d.error}}}}}catch(e){o={error:e}}finally{try{S&&!S.done&&(s=C.return)&&s.call(C)}finally{if(o)throw o.error}}return t.columns}return e})),e?(this.pluginCtrl.extApi.contextApi.clear(),this.grid.ds.refresh()):this.grid.ds.length>0&&this.grid.ds.refresh(d)},e.prototype.updateState=function(e,t){var r=void 0===e;t?this.enable(!r):this.disable(!0)},e.prototype.updateColumns=function(e){var t,r,o=this._header.prop;this.columns=[];try{for(var n=a(e),s=n.next();!s.done;s=n.next()){var u=s.value;u.orgProp===o?this.selfColumn=u:this.columns.push(u)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}this.selfColumn||(this.selfColumn=new i.PblColumn(this._header,this.pluginCtrl.extApi.columnStore.groupStore))},e.decorators=[{type:t.Directive,args:[{selector:"pbl-ngrid[transpose]"}]}],e.ctorParameters=function(){return[{type:i.PblNgridComponent},{type:i.PblNgridPluginController},{type:i.PblNgridConfigService}]},e.propDecorators={transpose:[{type:t.Input}],header:[{type:t.Input,args:["transposeHeaderCol"]}],defaultCol:[{type:t.Input,args:["transposeDefaultCol"]}],matchTemplates:[{type:t.Input}]},e}();var m=function(){function e(){}return e.NGRID_PLUGIN=i.ngridPlugin({id:"transpose"},y),e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule,i.PblNgridModule],declarations:[y],exports:[y]}]}],e}();e.PblNgridTransposeModule=m,e.ɵa="transpose",e.ɵb=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pebula-ngrid-transpose.umd.min.js.map