!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@angular/common"),require("@angular/material/checkbox"),require("@pebula/ngrid"),require("@angular/cdk/coercion"),require("@pebula/utils"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@pebula/ngrid/transpose",["exports","@angular/core","@angular/common","@angular/material/checkbox","@pebula/ngrid","@angular/cdk/coercion","@pebula/utils","rxjs","rxjs/operators"],r):r(((e=e||self).pebula=e.pebula||{},e.pebula.ngrid=e.pebula.ngrid||{},e.pebula.ngrid.transpose={}),e.ng.core,e.ng.common,e.ng.material.checkbox,e.pebula.ngrid,e.ng.cdk.coercion,e.pebula.utils,e.rxjs,e.rxjs.operators)}(this,(function(e,r,t,o,n,i,a,s,l){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function u(e,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,r)}function c(e){var r="function"==typeof Symbol&&e[Symbol.iterator],t=0;return r?r.call(e):{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}}}function d(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,n,i=t.call(e),a=[];try{for(;(void 0===r||r-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}return a}var p=Symbol("LOCAL_COLUMN_DEF"),h={},f=function(){function e(e,r,t,o){this.grid=e,this.pluginCtrl=r,this.updateColumns=t,this.sourceFactoryWrapper=o,this.init(),e.columns&&e.columnApi.visibleColumns.length>0&&this.onInvalidateHeaders(),this.onDataSource(this.grid.ds)}return e.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,a.UnRx.kill(this,this.grid),this.grid.showHeader=this.headerRow,this.grid.columns=this.columnsInput,e&&(this.grid.invalidateColumns(),this.grid.ds.refresh(h)))},e.prototype.init=function(){var e=this;this.headerRow=this.grid.showHeader,this.grid.showHeader=!1,this.pluginCtrl.events.pipe(a.UnRx(this,this.grid)).subscribe((function(r){return"onInvalidateHeaders"===r.kind&&e.onInvalidateHeaders()})),this.pluginCtrl.events.pipe(a.UnRx(this,this.grid)).subscribe((function(r){return"onDataSource"===r.kind&&e.onDataSource(r.curr)}))},e.prototype.onInvalidateHeaders=function(){this.grid.columns[p]||(this.columnsInput=this.grid.columns,this.storeColumns=this.grid.columnApi.visibleColumns,this.updateColumns())},e.prototype.onDataSource=function(e){var r=this;this.unPatchDataSource(),e&&(this.ds=e,this.dsSourceFactory=e.adapter.sourceFactory,this.ds.adapter.sourceFactory=function(e){var t=e.data.changed&&e.data.curr===h?r.ds.source:r.dsSourceFactory(e);return!1===t?t:r.destroyed?(r.unPatchDataSource(),r.rawSource):(s.isObservable(t)?t:Array.isArray(t)?s.of(t):s.from(t)).pipe(l.tap((function(e){return r.rawSource=e})),l.map(r.sourceFactoryWrapper))})},e.prototype.unPatchDataSource=function(){this.ds&&(this.ds.adapter.sourceFactory=this.dsSourceFactory,this.ds=this.dsSourceFactory=void 0)},e}();var g=Symbol("TRANSFORM_ROW_REF");function y(e){return e.getValue(this.data[g])}function m(e,r){var t;return{prop:"__transform_item_"+r+"__",data:(t={},t[g]=e,t)}}var b={prop:"__transpose__",css:"pbl-ngrid-header-cell pbl-ngrid-transposed-header-cell"},v="transpose",C=function(){function e(e,r,t){this.grid=e,this.pluginCtrl=r,this._header=b,this._removePlugin=r.setPlugin(v,this);var o=t.get("transposePlugin");o&&(this.header=o.header,this.defaultCol=o.defaultCol||{},this.matchTemplates=o.matchTemplates||!1)}return Object.defineProperty(e.prototype,"transpose",{get:function(){return this.enabled},set:function(e){if((e=i.coerceBooleanProperty(e))!==this.enabled){var r=void 0===this.enabled;this.enabled=e,e?this.enable(!r):this.disable(!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"header",{set:function(e){this._header=Object.assign({},b,e||{})},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this._removePlugin(this.grid),this.disable(!1)},e.prototype.disable=function(e){if(this.gridState){var r=this.gridState;this.columns=this.selfColumn=this.gridState=this.columns=this.selfColumn=void 0,r.destroy(e)}},e.prototype.enable=function(e){var r=this;void 0===e&&(e=!1),this.gridState&&this.disable(!1);this.gridState=new f(this.grid,this.pluginCtrl,(function(){return r.updateColumns(r.grid.columnApi.visibleColumns)}),(function(e){var t,o,a,s,l;if(e){var u=r.grid.columns=(t=n.columnFactory().default(r.defaultCol||{})).table.apply(t,function(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(d(arguments[r]));return e}([r.selfColumn],e.map(m))).build(),h=r.gridState.columnsInput;u.header=h.header,u.headerGroup=h.headerGroup,u.footer=h.footer,u[p]=!0,r.grid.invalidateColumns();var f,g=i.coerceBooleanProperty(r.matchTemplates),b=r._header.prop,v=["type"];g&&v.push("cellTpl");try{for(var C=c(r.grid.columnApi.visibleColumns),P=C.next();!P.done;P=C.next()){var S=P.value;if(S.orgProp===b)S.getValue=function(e){return f=e,e.label};else{S.getValue=y;var x=function(e){Object.defineProperty(S,e,{configurable:!0,get:function(){return f&&f[e]},set:function(e){}})};try{for(var _=c(v),j=_.next();!j.done;j=_.next()){x(j.value)}}catch(e){s={error:e}}finally{try{j&&!j.done&&(l=_.return)&&l.call(_)}finally{if(s)throw s.error}}}}}catch(e){o={error:e}}finally{try{P&&!P.done&&(a=C.return)&&a.call(C)}finally{if(o)throw o.error}}return r.columns}return e})),e?(this.pluginCtrl.extApi.contextApi.clear(),this.grid.ds.refresh()):this.grid.ds.length>0&&this.grid.ds.refresh(h)},e.prototype.updateColumns=function(e){var r,t,o=this._header.prop;this.columns=[];try{for(var i=c(e),a=i.next();!a.done;a=i.next()){var s=a.value;s.orgProp===o?this.selfColumn=s:this.columns.push(s)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(r)throw r.error}}this.selfColumn||(this.selfColumn=new n.PblColumn(this._header,this.pluginCtrl.extApi.columnStore.groupStore))},e.ctorParameters=function(){return[{type:n.PblNgridComponent},{type:n.PblNgridPluginController},{type:n.PblNgridConfigService}]},e.decorators=[{type:r.Directive,args:[{selector:"pbl-ngrid[transpose]"}]}],e.ctorParameters=function(){return[{type:n.PblNgridComponent},{type:n.PblNgridPluginController},{type:n.PblNgridConfigService}]},e.propDecorators={transpose:[{type:r.Input}],header:[{type:r.Input,args:["transposeHeaderCol"]}],defaultCol:[{type:r.Input,args:["transposeDefaultCol"]}],matchTemplates:[{type:r.Input}]},e=function(e,r,t,o){var n,i=arguments.length,a=i<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,r,t,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(r,t,a):n(r,t))||a);return i>3&&a&&Object.defineProperty(r,t,a),a}([n.NgridPlugin({id:v}),a.UnRx(),u("design:paramtypes",[n.PblNgridComponent,n.PblNgridPluginController,n.PblNgridConfigService])],e)}();var P=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{imports:[t.CommonModule,o.MatCheckboxModule,n.PblNgridModule],declarations:[C],exports:[C]}]}],e}();e.PblNgridTransposeModule=P,e.Éµa=C,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pebula-ngrid-transpose.umd.min.js.map