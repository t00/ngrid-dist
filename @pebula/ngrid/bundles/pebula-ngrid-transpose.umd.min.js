!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/material/checkbox"),require("@pebula/ngrid"),require("@angular/cdk/coercion"),require("@pebula/utils"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@pebula/ngrid/transpose",["exports","@angular/core","@angular/common","@angular/material/checkbox","@pebula/ngrid","@angular/cdk/coercion","@pebula/utils","rxjs","rxjs/operators"],t):t(((e=e||self).pebula=e.pebula||{},e.pebula.ngrid=e.pebula.ngrid||{},e.pebula.ngrid.transpose={}),e.ng.core,e.ng.common,e.ng.material.checkbox,e.pebula.ngrid,e.ng.cdk.coercion,e.pebula.utils,e.rxjs,e.rxjs.operators)}(this,function(e,t,r,o,n,a,i,l,s){"use strict";function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}var d=Symbol("LOCAL_COLUMN_DEF"),h={},f=function(){function e(e,t,r,o){this.table=e,this.pluginCtrl=t,this.updateColumns=r,this.sourceFactoryWrapper=o,this.init(),e.columns&&e.columnApi.visibleColumns.length>0&&this.onInvalidateHeaders(),this.onDataSource(this.table.ds)}return e.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,i.UnRx.kill(this,this.table),this.table.showHeader=this.headerRow,this.table.columns=this.columnsInput,e&&(this.table.invalidateColumns(),this.table.ds.refresh(h)))},e.prototype.init=function(){var e=this;this.headerRow=this.table.showHeader,this.table.showHeader=!1,this.pluginCtrl.events.pipe(i.UnRx(this,this.table)).subscribe(function(t){return"onInvalidateHeaders"===t.kind&&e.onInvalidateHeaders()}),this.pluginCtrl.events.pipe(i.UnRx(this,this.table)).subscribe(function(t){return"onDataSource"===t.kind&&e.onDataSource(t.curr)})},e.prototype.onInvalidateHeaders=function(){this.table.columns[d]||(this.columnsInput=this.table.columns,this.storeColumns=this.table.columnApi.visibleColumns,this.updateColumns())},e.prototype.onDataSource=function(e){var t=this;this.unPatchDataSource(),e&&(this.ds=e,this.dsSourceFactory=e.adapter.sourceFactory,this.ds.adapter.sourceFactory=function(e){var r=e.data.changed&&e.data.curr===h?t.ds.source:t.dsSourceFactory(e);return!1===r?r:t.destroyed?(t.unPatchDataSource(),t.rawSource):(l.isObservable(r)?r:Array.isArray(r)?l.of(r):l.from(r)).pipe(s.tap(function(e){return t.rawSource=e}),s.map(t.sourceFactoryWrapper))})},e.prototype.unPatchDataSource=function(){this.ds&&(this.ds.adapter.sourceFactory=this.dsSourceFactory,this.ds=this.dsSourceFactory=void 0)},e}();var b=Symbol("TRANSFORM_ROW_REF");function m(e){return e.getValue(this.data[b])}function y(e,t){var r;return{prop:"__transform_item_"+t+"__",data:(r={},r[b]=e,r)}}var g={prop:"__transpose__",css:"pbl-ngrid-header-cell pbl-ngrid-transposed-header-cell"},v="transpose",C=function(){function e(e,t,r){this.table=e,this.pluginCtrl=t,this._header=g,this._removePlugin=t.setPlugin(v,this);var o=r.get("transposePlugin");o&&(this.header=o.header,this.defaultCol=o.defaultCol||{},this.matchTemplates=o.matchTemplates||!1)}return Object.defineProperty(e.prototype,"transpose",{get:function(){return this.enabled},set:function(e){if((e=a.coerceBooleanProperty(e))!==this.enabled){var t=void 0===this.enabled;this.enabled=e,e?this.enable(!t):this.disable(!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"header",{set:function(e){this._header=Object.assign({},g,e||{})},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this._removePlugin(this.table),this.disable(!1)},e.prototype.disable=function(e){if(this.tableState){var t=this.tableState;this.columns=this.selfColumn=this.tableState=this.columns=this.selfColumn=void 0,t.destroy(e)}},e.prototype.enable=function(e){var t=this;void 0===e&&(e=!1),this.tableState&&this.disable(!1);this.tableState=new f(this.table,this.pluginCtrl,function(){return t.updateColumns(t.table.columnApi.visibleColumns)},function(e){var r,o,i,l,s;if(e){var u=t.table.columns=(r=n.columnFactory().default(t.defaultCol||{})).table.apply(r,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}([t.selfColumn],e.map(y))).build(),h=t.tableState.columnsInput;u.header=h.header,u.headerGroup=h.headerGroup,u.footer=h.footer,u[d]=!0,t.table.invalidateColumns();var f,b=a.coerceBooleanProperty(t.matchTemplates),g=t._header.prop,v=["type"];b&&v.push("cellTpl");try{for(var C=c(t.table.columnApi.visibleColumns),P=C.next();!P.done;P=C.next()){var S=P.value;if(S.orgProp===g)S.getValue=function(e){return f=e,e.label};else{S.getValue=m;var x=function(e){Object.defineProperty(S,e,{configurable:!0,get:function(){return f&&f[e]},set:function(e){}})};try{for(var _=c(v),j=_.next();!j.done;j=_.next()){x(j.value)}}catch(e){l={error:e}}finally{try{j&&!j.done&&(s=_.return)&&s.call(_)}finally{if(l)throw l.error}}}}}catch(e){o={error:e}}finally{try{P&&!P.done&&(i=C.return)&&i.call(C)}finally{if(o)throw o.error}}return t.columns}return e}),e?(this.pluginCtrl.extApi.contextApi.clear(),this.table.ds.refresh()):this.table.ds.length>0&&this.table.ds.refresh(h)},e.prototype.updateColumns=function(e){var t,r,o=this._header.prop;this.columns=[];try{for(var a=c(e),i=a.next();!i.done;i=a.next()){var l=i.value;l.orgProp===o?this.selfColumn=l:this.columns.push(l)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}this.selfColumn||(this.selfColumn=new n.PblColumn(this._header,this.pluginCtrl.extApi.columnStore.groupStore))},e.decorators=[{type:t.Directive,args:[{selector:"pbl-ngrid[transpose]"}]}],e.ctorParameters=function(){return[{type:n.PblNgridComponent},{type:n.PblNgridPluginController},{type:n.PblNgridConfigService}]},e.propDecorators={transpose:[{type:t.Input}],header:[{type:t.Input,args:["transposeHeaderCol"]}],defaultCol:[{type:t.Input,args:["transposeDefaultCol"]}],matchTemplates:[{type:t.Input}]},e=function(e,t,r,o){var n,a=arguments.length,i=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(i=(a<3?n(i):a>3?n(t,r,i):n(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}([n.TablePlugin({id:v}),i.UnRx(),u("design:paramtypes",[n.PblNgridComponent,n.PblNgridPluginController,n.PblNgridConfigService])],e)}();var P=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule,o.MatCheckboxModule,n.PblNgridModule],declarations:[C],exports:[C]}]}],e}();e.PblNgridTransposeModule=P,e.Éµa=C,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=pebula-ngrid-transpose.umd.min.js.map