!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/cdk/coercion"),require("@pebula/ngrid"),require("@angular/cdk/table"),require("@angular/common"),require("@pebula/ngrid/target-events"),require("@angular/cdk/keycodes")):"function"==typeof define&&define.amd?define("@pebula/ngrid/detail-row",["exports","@angular/core","@angular/cdk/coercion","@pebula/ngrid","@angular/cdk/table","@angular/common","@pebula/ngrid/target-events","@angular/cdk/keycodes"],t):t(((e=e||self).pebula=e.pebula||{},e.pebula.ngrid=e.pebula.ngrid||{},e.pebula.ngrid["detail-row"]={}),e.ng.core,e.ng.cdk.coercion,e.pebula.ngrid,e.ng.cdk.table,e.ng.common,e.pebula.ngrid["target-events"],e.ng.cdk.keycodes)}(this,(function(e,t,o,i,r,n,a,l){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function d(e,t){function o(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}function c(e){var t="function"==typeof Symbol&&Symbol.iterator,o=t&&e[t],i=0;if(o)return o.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var u=function(e){function o(t,o){var i=e.call(this,t,o)||this;return i.kind="detailRow",i}return d(o,e),o.decorators=[{type:t.Directive,args:[{selector:"[pblNgridDetailRowDef]"}]}],o.ctorParameters=function(){return[{type:t.TemplateRef},{type:i.PblNgridRegistryService}]},o}(i.PblNgridSingleTemplateRegistry);var p=function(e){function o(t,o,i){var r=e.call(this,t,o)||this;return r.registry=i,r}return d(o,e),o.prototype.clone=function(){var e=Object.create(this);return this._columnsDiffer=this.columns=void 0,e},o.prototype.ngOnInit=function(){this.registry.setSingle("detailRowParent",this)},o.prototype.ngOnDestroy=function(){this.registry.setSingle("detailRowParent",void 0)},o.decorators=[{type:t.Directive,args:[{selector:"[pblNgridDetailRowParentRef]",inputs:["columns: pblNgridDetailRowParentRef","when: pblNgridDetailRowParentRefWhen"]}]}],o.ctorParameters=function(){return[{type:t.TemplateRef},{type:t.IterableDiffers},{type:i.PblNgridRegistryService}]},o}(r.CdkRowDef);var g=function(){function e(){}return e.decorators=[{type:t.Component,args:[{selector:"pbl-ngrid-default-detail-row-parent",template:'<pbl-ngrid-row *pblNgridDetailRowParentRef="let row; gridInstance as gridInstance" [grid]="gridInstance" [detailRow]="row"></pbl-ngrid-row>'}]}],e}(),f=function(){return!0},h=function(){return!1};var w=function(){function e(e,o,i){var r=this;this.grid=e,this.injector=i,this.whenContextChange="render",this.toggleChange=new t.EventEmitter,this.toggledRowContextChange=new t.EventEmitter,this._isSimpleRow=f,this._isDetailRow=h,this._detailRowRows=new Map,this._removePlugin=o.setPlugin("detailRow",this);var n=o.events.subscribe((function(t){"onInit"===t.kind&&(n.unsubscribe(),n=void 0,o.hasPlugin("targetEvents")||o.createPlugin("targetEvents"),e.registry.changes.subscribe((function(t){var o,i;try{for(var n=c(t),a=n.next();!a.done;a=n.next()){var l=a.value;switch(l.type){case"detailRowParent":"remove"===l.op&&(e._cdkTable.removeRowDef(l.value),r._detailRowDef=void 0),r.setupDetailRowParent()}}}catch(e){o={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(o)throw o.error}}})),r._detailRow?r.updateTable():r.setupDetailRowParent())}))}return Object.defineProperty(e.prototype,"detailRow",{get:function(){return this._detailRow},set:function(e){if(this._detailRow!==e){var t=this.grid;"function"==typeof e?(this._isSimpleRow=function(t,o){return!e(t,o)},this._isDetailRow=e):(e=o.coerceBooleanProperty(e),this._isDetailRow=e?f:h,this._isSimpleRow=e?h:f),this._detailRow=e,t.isInit&&this.updateTable()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"singleDetailRow",{set:function(e){var t=this;e=o.coerceBooleanProperty(e),this._forceSingle!==e&&(this._forceSingle=e,e&&this._openedRow&&this._openedRow.expended&&this._detailRowRows.forEach((function(e){e.row!==t._openedRow.row&&e.toggle(!1)})))},enumerable:!0,configurable:!0}),e.prototype.addDetailRow=function(e){this._detailRowRows.set(e.row,e)},e.prototype.removeDetailRow=function(e){this._detailRowRows.delete(e.row)},e.prototype.toggleDetailRow=function(e,t){var o=this._detailRowRows.get(e);if(o)return o.toggle(t),o.expended},e.prototype.ngOnDestroy=function(){this._defaultParentRef&&this._defaultParentRef.destroy(),this._removePlugin(this.grid)},e.prototype.detailRowToggled=function(e){var t=this._openedRow&&this._openedRow.row===e.row;e.expended?(this._forceSingle&&this._openedRow&&this._openedRow.expended&&!t&&this._openedRow.toggle(),this._openedRow=e):t&&(this._openedRow=void 0),this.toggleChange.emit(e)},e.prototype.setupDetailRowParent=function(){var e=this,o=this.grid,i=o._cdkTable;if(this._detailRowDef&&(i.removeRowDef(this._detailRowDef),this._detailRowDef=void 0),this.detailRow){var r=o.registry.getSingle("detailRowParent");if(r)this._detailRowDef=r=r.clone(),Object.defineProperty(r,"columns",{enumerable:!0,get:function(){return o.columnApi.visibleColumnIds}}),Object.defineProperty(r,"when",{enumerable:!0,get:function(){return e._isDetailRow}}),r.ngOnChanges({columns:{isFirstChange:function(){return!0},firstChange:!0,currentValue:r.columns,previousValue:null}});else if(!this._defaultParentRef)return this._defaultParentRef=this.injector.get(t.ComponentFactoryResolver).resolveComponentFactory(g).create(this.injector),void this._defaultParentRef.changeDetectorRef.detectChanges()}this.resetTableRowDefs()},e.prototype.resetTableRowDefs=function(){var e=this.grid;this._detailRowDef&&(!1===this._detailRow?e._cdkTable.removeRowDef(this._detailRowDef):e._cdkTable.addRowDef(this._detailRowDef))},e.prototype.updateTable=function(){this.grid._tableRowDef.when=this._isSimpleRow,this.setupDetailRowParent(),this.grid._cdkTable.updateRowDefCache(),this.grid._cdkTable.multiTemplateDataRows=!!this._detailRow},e.decorators=[{type:t.Directive,args:[{selector:"pbl-ngrid[detailRow]",exportAs:"pblNgridDetailRow"}]}],e.ctorParameters=function(){return[{type:i.PblNgridComponent},{type:i.PblNgridPluginController},{type:t.Injector}]},e.propDecorators={detailRow:[{type:t.Input}],singleDetailRow:[{type:t.Input}],excludeToggleFrom:[{type:t.Input}],whenContextChange:[{type:t.Input}],toggleChange:[{type:t.Output}],toggledRowContextChange:[{type:t.Output}]},e}();var R=function(e){function o(t,o,i){var r=e.call(this,t,o)||this;return r.vcRef=i,r.opened=!1,r}return d(o,e),Object.defineProperty(o.prototype,"expended",{get:function(){return this.opened},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"row",{set:function(e){this.updateRow()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"_element",{get:function(){return this.el.nativeElement},enumerable:!0,configurable:!0}),o.prototype.ngOnInit=function(){var e=this,t=i.PblNgridPluginController.find(this.extApi.grid);this.plugin=t.getPlugin("detailRow"),this.plugin.addDetailRow(this);var o=t.getPlugin("targetEvents");o.cellClick.pipe(i.utils.unrx(this)).subscribe((function(t){if("data"===t.type&&t.row===e.context.$implicit){var o=e.plugin.excludeToggleFrom;o&&o.some((function(e){return t.column.id===e}))||e.toggle()}})),o.rowClick.pipe(i.utils.unrx(this)).subscribe((function(t){t.root||"data"!==t.type||t.row!==e.context.$implicit||e.toggle()}))},o.prototype.ngOnDestroy=function(){i.utils.unrx.kill(this),this.plugin.removeDetailRow(this)},o.prototype.updateRow=function(){var t=this.context&&this.context.$implicit;if(e.prototype.updateRow.call(this),this.opened){var o=this.context&&this.context.$implicit;if(o!==t&&o){switch(this.plugin.whenContextChange){case"render":this.render();break;case"close":this.toggle(!1)}this.plugin.toggledRowContextChange.next(this.createEvent())}}},o.prototype.toggle=function(e){this.opened!==e&&(this.opened?(this.vcRef.clear(),this._element.classList.remove("pbl-row-detail-opened")):this.render(),this.opened=this.vcRef.length>0,this.opened&&this._element.classList.add("pbl-row-detail-opened"),this.plugin.detailRowToggled(this.createEvent()))},o.prototype.handleKeydown=function(e){if(e.target===this._element){var t=e.keyCode;(t===l.ENTER||t===l.SPACE)&&(e.preventDefault(),this.toggle())}},o.prototype.createEvent=function(){var e=Object.create(this);return Object.defineProperty(e,"row",{value:this.context.$implicit}),e},o.prototype.render=function(){if(this.vcRef.clear(),this.context.$implicit){var e=this.context.grid.registry.getSingle("detailRow");e&&this.vcRef.createEmbeddedView(e.tRef,this.context)}},o.decorators=[{type:t.Component,args:[{selector:"pbl-ngrid-row[detailRow]",exportAs:"pblNgridDetailRow",host:{class:"pbl-ngrid-row pbl-row-detail-parent",role:"row","[attr.tabindex]":"grid?.rowFocus","(keydown)":"handleKeydown($event)"},template:r.CDK_ROW_TEMPLATE,providers:[{provide:r.CdkRow,useExisting:o}],changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None,styles:[".pbl-row-detail-parent { position: relative; cursor: pointer; }"]}]}],o.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[i.EXT_API_TOKEN]}]},{type:t.ElementRef},{type:t.ViewContainerRef}]},o.propDecorators={row:[{type:t.Input,args:["detailRow"]}]},o}(i.PblNgridRowComponent);var y=[w,R,p,u],b=function(){function e(){}return e.NGRID_PLUGIN=i.ngridPlugin({id:"detailRow"},w),e.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule,r.CdkTableModule,i.PblNgridModule,a.PblNgridTargetEventsModule],declarations:[y,g],exports:[y],entryComponents:[R,g]}]}],e}();e.PblNgridDetailRowModule=b,e.toggleDetailRow=function(e,t,o){var r=i.PblNgridPluginController.find(e);if(r){var n=r.getPlugin("detailRow");if(n)return n.toggleDetailRow(t,o)}},e.ɵa="detailRow",e.ɵb=w,e.ɵc=R,e.ɵd=u,e.ɵe=p,e.ɵf=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pebula-ngrid-detail-row.umd.min.js.map