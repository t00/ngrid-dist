!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("rxjs/operators"),require("@angular/core"),require("@pebula/ngrid"),require("@angular/cdk/keycodes"),require("@angular/common"),require("@angular/cdk/table"),require("@angular/cdk/coercion")):"function"==typeof define&&define.amd?define("@pebula/ngrid/target-events",["exports","rxjs","rxjs/operators","@angular/core","@pebula/ngrid","@angular/cdk/keycodes","@angular/common","@angular/cdk/table","@angular/cdk/coercion"],t):t(((e=e||self).pebula=e.pebula||{},e.pebula.ngrid=e.pebula.ngrid||{},e.pebula.ngrid["target-events"]={}),e.rxjs,e.rxjs.operators,e.ng.core,e.pebula.ngrid,e.ng.cdk.keycodes,e.ng.common,e.ng.cdk.table,e.ng.cdk.coercion)}(this,(function(e,t,r,n,o,i,l,c,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function d(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),l=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)l.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return l}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}function v(e){return!!e.cellTarget}function g(e){return v(e)&&!!e.context}function y(e){return"row"===e.getAttribute("role")}function b(e){for(;e.parentElement;){if(y(e.parentElement))return e;e=e.parentElement}}function w(e,t){var r=e.getAttribute("data-rowtype")||"data",n=0;switch(r){case"data":for(var o=e;e.previousElementSibling;)n++,e=e.previousElementSibling;for(n=Math.min(n,t.length-1);n>-1;){if(t.get(n).rootNodes[0]===o)return{type:"data",subType:"data",rowIndex:n};n--}return;case"header":case"footer":return{type:r,subType:"data",rowIndex:n};default:for(;e.previousElementSibling&&e.previousElementSibling.getAttribute("data-rowtype")===r;)n++,e=e.previousElementSibling;return{type:"meta-footer"===r?"footer":"header",subType:"meta",rowIndex:n}}}function h(e,t,r){var n,o,i,l,c=[];try{for(var a=d(r),u=a.next();!u.done;u=a.next()){var s=u.value;try{for(var p=(i=void 0,d(t)),f=p.next();!f.done;f=p.next()){var v=f.value;e.findRowInCache(s.rowIdent).cells[v.colIndex]&&c.push({rowIdent:s.rowIdent,colIndex:v.colIndex})}}catch(e){i={error:e}}finally{try{f&&!f.done&&(l=p.return)&&l.call(p)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return c}var m=/^mac/.test(navigator.platform.toLowerCase()),x=function(e){return 0===e.source.button};function C(e){var t=function(){return"cell"===e.grid.focusMode},n=function(e){var t=e.grid.contextApi;function r(e){var r,n,o=e.context,i=t.focusedCell||{rowIdent:o.rowContext.identity,colIndex:o.index},l=t.findRowInCache(i.rowIdent),c=[],a=[];try{for(var u=d(function(e,t){for(var r=Math.min(e,t),n=r===e?t:e,o=[],i=r+1;i<n;i++)o.push(i);return o}(i.colIndex,o.index)),s=u.next();!s.done;s=u.next()){var p=s.value;c.push({rowIdent:i.rowIdent,colIndex:p})}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}c.push({rowIdent:i.rowIdent,colIndex:o.index});var v=Math.abs(o.rowContext.dataIndex-l.dataIndex),g=l.dataIndex>o.rowContext.dataIndex?-1:1;for(p=1;p<=v;p++){var y=t.findRowInCache(i.rowIdent,g*p,!0);a.push({rowIdent:y.identity,colIndex:i.colIndex})}var b=h(t,c,a);t.selectCells(f([i],c,a,b),!1,!0)}return{handleMouseDown:function(e){var n,o,i;t.focusedCell&&e.source.shiftKey?r(e):(m?e.source.metaKey:e.source.ctrlKey)?e.context.selected?t.unselectCells([e.context]):t.selectCells([e.context]):(n=e.context.rowContext.identity,o=e.context.index,t.focusCell({rowIdent:n,colIndex:o},i))},handleKeyDown:function(e){var r,n,o,l=e.source;if(v(e)){var c=e.cellTarget,a=1,u=void 0;switch(l.keyCode){case i.UP_ARROW:a=-1;case i.DOWN_ARROW:u="v";break;case i.LEFT_ARROW:a=-1;case i.RIGHT_ARROW:u="h";break;default:return}var s=t.getCell(c),d=t.focusedCell||{rowIdent:s.rowContext.identity,colIndex:s.index};l.shiftKey?function(e,r){var n=e.rowIdent,o=e.colIndex,i=t.findRowInCache(n),l=p(r,2),c=l[0],a=l[1],u=[i.cells[o-1],i.cells[o+1]],s=[t.findRowInCache(n,-1,!0),t.findRowInCache(n,1,!0)],d=(u[0]&&u[0].selected?-1:0)+(u[1]&&u[1].selected?1:0),v=(s[0]&&s[0].cells[o].selected?-1:0)+(s[1]&&s[1].cells[o].selected?1:0);0===d&&(d+=c);0===v&&(v+=a);var g=[];if(0!==d){for(var y=o,b=i.cells[o];b&&b.selected;)g.push({rowIdent:n,colIndex:y}),y+=d,b=i.cells[y];c&&(d===c?b&&g.push({rowIdent:n,colIndex:y}):g.pop())}var w=[];if(0!==v){for(var m=n,x=t.findRowInCache(m,v,!0);x&&x.cells[o].selected;)m=x.identity,w.push({rowIdent:m,colIndex:o}),x=t.findRowInCache(m,v,!0);a&&(v===a?x&&w.push({rowIdent:x.identity,colIndex:o}):w.pop())}var C=h(t,g,w);t.selectCells(f([e],g,w,C),!1,!0)}(d,"h"===u?[a,0]:[0,a]):(r=d,n="h"===u?[a,0]:[0,a],(o=t.findRowInCache(r.rowIdent,n[1],!0))&&t.focusCell({rowIdent:o.identity,colIndex:r.colIndex+n[0]},!0))}},handleSelectionChangeByMouseClickAndMove:r}}(e);e.keyDown.pipe(r.filter(t)).subscribe(n.handleKeyDown),e.mouseDown.pipe(r.filter(t),r.filter(g),r.filter(x),r.tap((function(e){e.source.stopPropagation(),e.source.preventDefault()})),r.tap(n.handleMouseDown),r.switchMap((function(){return e.cellEnter.pipe(r.takeUntil(e.mouseUp))})),r.filter(g),r.filter(x)).subscribe(n.handleSelectionChangeByMouseClickAndMove)}function E(e){return e.observers.length>0}function k(){o.PblColumn.extendProperty("editable")}var I=function(){function e(e,r,o){var i=this;if(this.grid=e,this.injector=r,this.pluginCtrl=o,this.rowClick=new n.EventEmitter,this.rowDblClick=new n.EventEmitter,this.rowEnter=new n.EventEmitter,this.rowLeave=new n.EventEmitter,this.cellClick=new n.EventEmitter,this.cellDblClick=new n.EventEmitter,this.cellEnter=new n.EventEmitter,this.cellLeave=new n.EventEmitter,this.mouseDown=new n.EventEmitter,this.mouseUp=new n.EventEmitter,this.keyUp=new n.EventEmitter,this.keyDown=new n.EventEmitter,this.destroyed=new t.ReplaySubject,this._removePlugin=o.setPlugin("targetEvents",this),e.isInit)this.init();else var l=o.events.subscribe((function(e){"onInit"===e.kind&&(i.init(),l.unsubscribe(),l=void 0)}))}return Object.defineProperty(e.prototype,"table",{get:function(){return this.grid},enumerable:!0,configurable:!0}),e.create=function(t,r){return new e(t,r,o.PblNgridPluginController.find(t))},e.prototype.init=function(){this.setupDomEvents(),C(this)},e.prototype.setupDomEvents=function(){var e,n,o=this,i=this.grid,l=i._cdkTable,c=l._element,a=function(e,t){var r,n,c=e.parentElement,a=w(c,l._rowOutlet.viewContainer);if(a){var u=s(s({},a),{source:t,cellTarget:e,rowTarget:c});if("data"===a.type)u.row=i.ds.renderedData[a.rowIndex];else if("meta"===u.subType){var p=o.pluginCtrl.extApi.metaRowService,f="header"===u.type?p.header:p.footer;try{for(var v=d([f.fixed,f.row,f.sticky]),g=v.next();!g.done;g=v.next()){var y=g.value.find((function(e){return e.el===u.rowTarget}));if(y){u.rowIndex=y.index;break}}}catch(e){r={error:e}}finally{try{g&&!g.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}}if(u.colIndex=function(e){for(var t=0;e=e.previousElementSibling;)t++;return t}(e),"data"===a.subType){var b=o.grid.columnApi.findColumnAt(u.colIndex),h=o.grid.columnApi.indexOf(b);u.column=b,u.context=o.pluginCtrl.extApi.contextApi.getCell(u.rowIndex,h)}else{var m=o.pluginCtrl.extApi.columnStore,x=m.metaColumnIds[a.type][u.rowIndex],C=m.find(x.keys[u.colIndex]);x.isGroup?(u.subType="meta-group",u.column="header"===a.type?C.headerGroup:C.footerGroup):u.column="header"===a.type?C.header:C.footer}return u}},u=function(e,t,r){if(r){var n={source:t,rowTarget:e,type:r.type,subType:r.subType,rowIndex:r.rowIndex,root:r};return"data"===r.type&&(n.row=r.row,n.context=r.context.rowContext),n}var i=w(e,l._rowOutlet.viewContainer);if(i){var c=s(s({},i),{source:t,rowTarget:e});if("data"===i.type&&(c.context=o.pluginCtrl.extApi.contextApi.getRow(i.rowIndex),c.row=c.context.$implicit),"data"!==i.subType)o.pluginCtrl.extApi.columnStore.metaColumnIds[i.type][c.rowIndex].isGroup&&(c.subType="meta-group");return c}},p=function(t){if(e){var r=e;return o.cellLeave.emit(Object.assign({},r,{source:t})),e=void 0,r}},f=function(e){if(n){var t=n;return o.rowLeave.emit(Object.assign({},t,{source:e})),n=void 0,t}},v=function(e){var t,r,n=(r=b((t=e).target))?{type:"cell",target:r}:y(t.target)?{type:"cell",target:t.target}:void 0;if(n)if("cell"===n.type){var i=a(n.target,e);if(i)return{type:n.type,event:i,waitTime:E(o.cellDblClick)?250:1}}else if("row"===n.type){var l=u(n.target,e);if(l)return{type:n.type,event:l,waitTime:E(o.rowDblClick)?250:1}}},g=function(e){var t="cell"===e.type?e.event:void 0;return{cellEvent:t,rowEvent:t?u(t.rowTarget,t.source,t):e.event}},h=function(e,n){t.fromEvent(c,e).pipe(r.takeUntil(o.destroyed),r.filter((function(e){return E(n)})),r.map(v),r.filter((function(e){return!!e}))).subscribe((function(e){var t=g(e),r=t.cellEvent,i=t.rowEvent;n.emit(r||i),o.syncRow(r||i)}))};h("mouseup",this.mouseUp),h("mousedown",this.mouseDown),h("keyup",this.keyUp),h("keydown",this.keyDown);var m=t.fromEvent(c,"click").pipe(r.takeUntil(this.destroyed),r.filter((function(e){return E(o.cellClick)||E(o.cellDblClick)||E(o.rowClick)||E(o.rowDblClick)})),r.map(v),r.filter((function(e){return!!e})));m.pipe(r.bufferWhen((function(){return m.pipe(r.debounce((function(e){return t.timer(e.waitTime)})))})),r.filter((function(e){return e.length>0}))).subscribe((function(e){var t=e.shift(),r=1===e.length,n=g(t),i=n.cellEvent,l=n.rowEvent;r?(i&&o.cellDblClick.emit(i),o.rowDblClick.emit(l)):(i&&o.cellClick.emit(i),o.rowClick.emit(l)),o.syncRow(i||l)})),t.fromEvent(c,"mouseleave").pipe(r.takeUntil(this.destroyed)).subscribe((function(e){var t=p(e);(t=f(e)||t)&&o.syncRow(t)})),t.fromEvent(c,"mousemove").pipe(r.takeUntil(this.destroyed)).subscribe((function(t){var r,i,l=b(t.target),c=e&&e.cellTarget,s=n&&n.rowTarget;if(c!==l&&(i=p(t)||i),l){if(c===l)return;(r=a(l,t))&&o.cellEnter.emit(e=r)}var d=r&&r.rowTarget||y(t.target)&&t.target;if(s!==d&&(i=f(t)||i),d&&s!==d){var v=u(d,t,r);v&&o.rowEnter.emit(n=v)}i&&o.syncRow(i)}))},e.prototype.destroy=function(){this.destroyed.next(),this.destroyed.complete(),this._removePlugin(this.grid)},e.prototype.syncRow=function(e){this.grid._cdkTable.syncRows(e.type,e.rowIndex)},e}();var P=function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return function(e,t){function r(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.ngOnDestroy=function(){this.destroy()},t.decorators=[{type:n.Directive,args:[{selector:"pbl-ngrid[targetEvents], pbl-ngrid[rowClick], pbl-ngrid[rowDblClick], pbl-ngrid[rowEnter], pbl-ngrid[rowLeave], pbl-ngrid[cellClick], pbl-ngrid[cellDblClick], pbl-ngrid[cellEnter], pbl-ngrid[cellLeave], pbl-ngrid[keyDown], pbl-ngrid[keyUp]",outputs:["rowClick","rowDblClick","rowEnter","rowLeave","cellClick","cellDblClick","cellEnter","cellLeave","keyDown","keyUp"]}]}],t.ctorParameters=function(){return[{type:o.PblNgridComponent},{type:n.Injector},{type:o.PblNgridPluginController}]},t}(I),D=function(){function e(e,t,r){var n=this;this._click=!1,this._dblClick=!1;var o=r.events.subscribe((function(e){"onInit"===e.kind&&(o.unsubscribe(),o=void 0,n.targetEventsPlugin=r.getPlugin("targetEvents")||r.createPlugin("targetEvents"),n.update())}))}return Object.defineProperty(e.prototype,"cellEditClick",{set:function(e){e=a.coerceBooleanProperty(e),this._click!==e&&(this._click=e,this.update())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellEditDblClick",{set:function(e){e=a.coerceBooleanProperty(e),this._dblClick!==e&&(this._dblClick=e,this.update())},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){o.utils.unrx.kill(this)},e.prototype.update=function(){this.targetEventsPlugin&&(o.utils.unrx.kill(this,this.targetEventsPlugin),this._click&&this.targetEventsPlugin.cellClick.pipe(o.utils.unrx(this,this.targetEventsPlugin)).subscribe((function(e){"data"===e.type&&e.column.editable&&e.context.startEdit(!0)})),this._dblClick&&this.targetEventsPlugin.cellDblClick.pipe(o.utils.unrx(this,this.targetEventsPlugin)).subscribe((function(e){"data"===e.type&&e.column.editable&&e.context.startEdit(!0)})))},e.decorators=[{type:n.Directive,args:[{selector:"pbl-ngrid[cellEditClick], pbl-ngrid[cellEditDblClick]"}]}],e.ctorParameters=function(){return[{type:o.PblNgridComponent},{type:n.Injector},{type:o.PblNgridPluginController}]},e.propDecorators={cellEditClick:[{type:n.Input}],cellEditDblClick:[{type:n.Input}]},e}();var T=function(){function e(e,t){e||o.PblNgridPluginController.created.subscribe((function(e){var r=t.get("targetEvents");if(r&&!0===r.autoEnable)var n=e.controller,o=n.events.subscribe((function(e){"onInit"===e.kind&&(n.hasPlugin("targetEvents")||n.createPlugin("targetEvents"),o.unsubscribe(),o=void 0)}))}))}return e.NGRID_PLUGIN=o.ngridPlugin({id:"targetEvents",factory:"create",runOnce:k},I),e.decorators=[{type:n.NgModule,args:[{imports:[l.CommonModule,c.CdkTableModule,o.PblNgridModule],declarations:[P,D],exports:[P,D]}]}],e.ctorParameters=function(){return[{type:e,decorators:[{type:n.Optional},{type:n.SkipSelf}]},{type:o.PblNgridConfigService}]},e}();e.PblNgridTargetEventsModule=T,e.PblNgridTargetEventsPlugin=I,e.isCellEvent=v,e.isDataCellEvent=g,e.ɵa="targetEvents",e.ɵb=k,e.ɵc=P,e.ɵd=D,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pebula-ngrid-target-events.umd.min.js.map