!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/operators"),require("@angular/core"),require("@angular/cdk/drag-drop"),require("rxjs"),require("@angular/cdk/coercion"),require("@angular/common"),require("@angular/cdk/scrolling"),require("@angular/cdk/bidi"),require("@pebula/ngrid"),require("@angular/cdk/platform")):"function"==typeof define&&define.amd?define("@pebula/ngrid/drag",["exports","rxjs/operators","@angular/core","@angular/cdk/drag-drop","rxjs","@angular/cdk/coercion","@angular/common","@angular/cdk/scrolling","@angular/cdk/bidi","@pebula/ngrid","@angular/cdk/platform"],e):e(((t=t||self).pebula=t.pebula||{},t.pebula.ngrid=t.pebula.ngrid||{},t.pebula.ngrid.drag={}),t.rxjs.operators,t.ng.core,t.ng.cdk.dragDrop,t.rxjs,t.ng.cdk.coercion,t.ng.common,t.ng.cdk.scrolling,t.ng.cdk.bidi,t.pebula.ngrid,t.ng.cdk.platform)}(this,(function(t,e,r,o,n,i,s,a,l,p,c){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var d=function(t,e){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function g(t,e){function r(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function u(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s}function h(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}var y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.beforeExit=new n.Subject,e}return g(e,t),e.prototype.withElement=function(t){return this.element=i.coerceElement(t),this},e.prototype.dispose=function(){this.beforeExit.complete(),t.prototype.dispose.call(this)},e}(o.DropListRef);var m=function(t){function e(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var n=t.apply(this,h(e))||this;return n.rootElementChanged=new r.EventEmitter,n.exited.subscribe((function(t){var e=t.container;e instanceof y&&e.beforeExit.next({item:n})})),n}return g(e,t),e.prototype.withRootElement=function(e){if(this.rootElementChanged){var r=i.coerceElement(e);this.getRootElement()!==r&&this.rootElementChanged.next({prev:this.getRootElement(),curr:r})}return t.prototype.withRootElement.call(this,e)},e.prototype.dispose=function(){this.rootElementChanged.complete(),t.prototype.dispose.call(this)},e}(o.DragRef);var b={dragStartThreshold:5,pointerDirectionChangeThreshold:5},D=function(){function t(t,e,r,o){this._document=t,this._ngZone=e,this._viewportRuler=r,this._dragDropRegistry=o}return t.prototype.createDrag=function(t,e){return void 0===e&&(e=b),new m(t,e,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)},t.prototype.createDropList=function(t){return new y(t,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:[s.DOCUMENT]}]},{type:r.NgZone},{type:a.ViewportRuler},{type:o.DragDropRegistry}]},t.ɵprov=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(s.DOCUMENT),r.ɵɵinject(r.NgZone),r.ɵɵinject(a.ViewportRuler),r.ɵɵinject(o.DragDropRegistry))},token:t,providedIn:"root"}),t}();var v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._draggablesSet=new Set,e}return g(e,t),Object.defineProperty(e.prototype,"pblDropListRef",{get:function(){return this._dropListRef},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;if(this.pblDropListRef instanceof y==!1)throw new Error("Invalid `DropListRef` injection, the ref is not an instance of PblDropListRef");this._dropListRef.beforeStarted.subscribe((function(){return t.beforeStarted()}))},e.prototype.addDrag=function(t){this._draggablesSet.add(t),this._draggables.reset(Array.from(this._draggablesSet.values())),this._draggables.notifyOnChanges()},e.prototype.removeDrag=function(t){var e=this._draggablesSet.delete(t);return e&&(this._draggables.reset(Array.from(this._draggablesSet.values())),this._draggables.notifyOnChanges()),e},e.prototype.beforeStarted=function(){if(this.originalElement||(this.originalElement=this.element),this.directContainerElement){var t=this.originalElement.nativeElement.querySelector(this.directContainerElement);this.element=new r.ElementRef(t)}else this.element=this.originalElement;this.pblDropListRef.withElement(this.element)},e.decorators=[{type:r.Directive,args:[{selector:"[cdkLazyDropList]",exportAs:"cdkLazyDropList",providers:[{provide:o.DragDrop,useExisting:D},{provide:o.CDK_DROP_LIST,useClass:e}],host:{class:"cdk-drop-list","[id]":"id","[class.cdk-drop-list-dragging]":"_dropListRef.isDragging()","[class.cdk-drop-list-receiving]":"_dropListRef.isReceiving()"}}]}],e.propDecorators={directContainerElement:[{type:r.Input,args:["cdkDropListDirectContainerElement"]}]},e}(o.CdkDropList);var _=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._hostNotRoot=!1,e}return g(n,t),Object.defineProperty(n.prototype,"rootElementSelectorClass",{set:function(t){var e,r;t!==this._rootClass&&this._hostNotRoot&&(this._rootClass&&(e=this.getRootElement().classList).remove.apply(e,h(this._rootClass.split(" "))),t&&(r=this.getRootElement().classList).add.apply(r,h(t.split(" ")))),this._rootClass=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pblDragRef",{get:function(){return this._dragRef},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cdkDropList",{get:function(){return this.dropContainer},set:function(t){this.cdkDropList&&this.cdkDropList.removeDrag(this),this.dropContainer=t,t&&(this._dragRef._withDropContainer(t._dropListRef),t.addDrag(this))},enumerable:!0,configurable:!0}),n.prototype.ngOnInit=function(){var t=this;if(this.pblDragRef instanceof m==!1)throw new Error("Invalid `DragRef` injection, the ref is not an instance of PblDragRef");this.pblDragRef.rootElementChanged.subscribe((function(e){var r,o,n=t._rootClass,i=t.element.nativeElement!==e.curr;n&&(t._hostNotRoot&&(r=e.prev.classList).remove.apply(r,h(n.split(" "))),i&&(o=e.curr.classList).add.apply(o,h(n.split(" ")))),t._hostNotRoot=i}))},n.prototype.ngAfterViewInit=function(){var t=this;this.started.subscribe((function(r){if(t.dropContainer){var o=t.getRootElement(),n=o.parentNode;o.nextSibling||n===t.dropContainer.element.nativeElement||t.ended.pipe(e.take(1)).subscribe((function(t){return n.appendChild(o)}))}}))},n.prototype.ngOnDestroy=function(){this.cdkDropList&&this.cdkDropList.removeDrag(this)},n.decorators=[{type:r.Directive,args:[{selector:"[cdkLazyDrag]",exportAs:"cdkLazyDrag",host:{class:"cdk-drag","[class.cdk-drag-dragging]":"_dragRef.isDragging()"},providers:[{provide:o.DragDrop,useExisting:D}]}]}],n.propDecorators={rootElementSelectorClass:[{type:r.Input,args:["cdkDragRootElementClass"]}],cdkDropList:[{type:r.Input}]},n}(o.CdkDrag);var R=function(t){function e(e,r){var o=t.call(this,e,r)||this;return o.element=e,o}return g(e,t),e.decorators=[{type:r.Directive,args:[{selector:"[pblDragHandle]",host:{class:"cdk-drag-handle"},providers:[{provide:o.CdkDragHandle,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:r.ElementRef},{type:o.CdkDrag,decorators:[{type:r.Optional}]}]},e}(o.CdkDragHandle);var C=0,P=function(t){function e(e,r,o,n,i,s,a){var l=t.call(this,o,n,i,s,a)||this;return l.grid=e,l.id="pbl-ngrid-row-reorder-list-"+C++,l._rowReorder=!1,l.directContainerElement=".pbl-ngrid-scroll-container",l._draggablesSet=new Set,l._removePlugin=r.setPlugin("rowReorder",l),l.dropped.subscribe((function(t){var r=t.item,o=e.ds.source.indexOf(r.draggedContext.row),n=t.currentIndex+e.ds.renderStart;l.grid.contextApi.clear(),l.grid.ds.moveItem(o,n,!0),l.grid._cdkTable.syncRows("data")})),l}return g(e,t),Object.defineProperty(e.prototype,"rowReorder",{get:function(){return this._rowReorder},set:function(t){t=i.coerceBooleanProperty(t),this._rowReorder=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblDropListRef",{get:function(){return this._dropListRef},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){v.prototype.ngOnInit.call(this)},e.prototype.addDrag=function(t){return v.prototype.addDrag.call(this,t)},e.prototype.removeDrag=function(t){return v.prototype.removeDrag.call(this,t)},e.prototype.beforeStarted=function(){v.prototype.beforeStarted.call(this)},e.prototype.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this),this._removePlugin(this.grid)},e.decorators=[{type:r.Directive,args:[{selector:"pbl-ngrid[rowReorder]",exportAs:"pblNgridRowReorder",inputs:["directContainerElement:cdkDropListDirectContainerElement"],host:{class:"cdk-drop-list","[id]":"id","[class.cdk-drop-list-dragging]":"_dropListRef.isDragging()","[class.cdk-drop-list-receiving]":"_dropListRef.isReceiving()","[class.pbl-row-reorder]":"rowReorder && !this.grid.ds?.sort.sort?.order && !this.grid.ds?.filter?.filter"},providers:[{provide:o.DragDrop,useExisting:D},{provide:o.CdkDropListGroup,useValue:void 0},{provide:o.CDK_DROP_LIST,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:p.PblNgridComponent},{type:p.PblNgridPluginController},{type:r.ElementRef},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:l.Directionality,decorators:[{type:r.Optional}]},{type:o.CdkDropListGroup,decorators:[{type:r.Optional},{type:r.SkipSelf}]}]},e.propDecorators={rowReorder:[{type:r.Input}]},e}(o.CdkDropList);var E=function(t){function e(e,r,o,n,i,s,a,l,p){var c=t.call(this,e,r,o,n,i,s,a,l,p)||this;return c.rootElementSelector="pbl-ngrid-row",c._hostNotRoot=!1,c.started.subscribe((function(t){var e=c._context,r=e.col,o=e.row,n=e.grid,i=e.value;c._draggedContext={col:r,row:o,grid:n,value:i}})),c}return g(e,t),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},set:function(t){this._context=t;var e=this.pluginCtrl=t&&p.PblNgridPluginController.find(t.grid),r=e&&e.getPlugin("rowReorder");this.cdkDropList=r||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"draggedContext",{get:function(){return this._draggedContext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rootElementSelectorClass",{set:function(t){var e,r;t!==this._rootClass&&this._hostNotRoot&&(this._rootClass&&(e=this.getRootElement().classList).remove.apply(e,h(this._rootClass.split(" "))),t&&(r=this.getRootElement().classList).add.apply(r,h(t.split(" ")))),this._rootClass=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblDragRef",{get:function(){return this._dragRef},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cdkDropList",{get:function(){return this.dropContainer},set:function(t){this.cdkDropList&&this.cdkDropList.removeDrag(this),this.dropContainer=t,t&&(this._dragRef._withDropContainer(t._dropListRef),t.addDrag(this))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){_.prototype.ngOnInit.call(this)},e.prototype.ngAfterViewInit=function(){_.prototype.ngAfterViewInit.call(this),t.prototype.ngAfterViewInit.call(this)},e.prototype.ngOnDestroy=function(){_.prototype.ngOnDestroy.call(this),t.prototype.ngOnDestroy.call(this)},e.decorators=[{type:r.Directive,args:[{selector:"[pblNgridRowDrag]",exportAs:"pblNgridRowDrag",host:{class:"cdk-drag","[class.cdk-drag-dragging]":"_dragRef.isDragging()"},providers:[{provide:o.DragDrop,useExisting:D},{provide:o.CdkDrag,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:r.ElementRef},{type:o.CdkDropList,decorators:[{type:r.Inject,args:[o.CDK_DROP_LIST]},{type:r.Optional},{type:r.SkipSelf}]},{type:void 0,decorators:[{type:r.Inject,args:[s.DOCUMENT]}]},{type:r.NgZone},{type:r.ViewContainerRef},{type:void 0,decorators:[{type:r.Inject,args:[o.CDK_DRAG_CONFIG]}]},{type:l.Directionality},{type:o.DragDrop},{type:r.ChangeDetectorRef}]},e.propDecorators={context:[{type:r.Input,args:["pblNgridRowDrag"]}],rootElementSelectorClass:[{type:r.Input,args:["cdkDragRootElementClass"]}],cdkDropList:[{type:r.Input}]},e}(o.CdkDrag);var k=0,L=function(t){function e(e,r,o,i,s,a,l){var p=t.call(this,o,i,s,a,l)||this;return p.table=e,p.id="pbl-ngrid-column-reorder-list-"+k++,p.orientation="horizontal",p.dragging=new n.BehaviorSubject(!1),p._columnReorder=!1,p._manualOverride=!1,p._draggablesSet=new Set,p._removePlugin=r.setPlugin("columnReorder",p),p.directContainerElement=".pbl-ngrid-header-row-main",p.dropped.subscribe((function(t){p.manualOverride||p.table.columnApi.moveColumn(t.item.column,t.currentIndex)})),p.dragging.subscribe((function(t){var e=o.nativeElement;t?e.classList.add("pbl-ngrid-column-list-dragging"):e.classList.remove("pbl-ngrid-column-list-dragging"),p.lastSwap=void 0})),p.monkeyPatchDropListRef(),p}return g(e,t),Object.defineProperty(e.prototype,"columnReorder",{get:function(){return this._columnReorder},set:function(t){t=i.coerceBooleanProperty(t),this._columnReorder=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manualOverride",{get:function(){return this._manualOverride},set:function(t){this._manualOverride=i.coerceBooleanProperty(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblGetItemIndexFromPointerPosition",{get:function(){return this._dropListRef._getItemIndexFromPointerPosition.bind(this._dropListRef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblGetPositionCacheItems",{get:function(){return this._dropListRef._itemPositions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblDropListRef",{get:function(){return this._dropListRef},enumerable:!0,configurable:!0}),e.prototype.addDrag=function(t){return v.prototype.addDrag.call(this,t)},e.prototype.removeDrag=function(t){return v.prototype.removeDrag.call(this,t)},e.prototype.ngOnInit=function(){var t=this;v.prototype.ngOnInit.call(this),this.dropped.subscribe((function(e){return t._pblReset()})),this.pblDropListRef.beforeExit.subscribe((function(e){return t._pblReset()}))},e.prototype.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this),this._removePlugin(this.table)},e.prototype.beforeStarted=function(){v.prototype.beforeStarted.call(this),this.lastSorted=void 0,this.dragging.next(!0)},e.prototype._pblReset=function(){this.dragging.next(!1),this.pblGetPositionCacheItems.forEach((function(t,e){var r,o;try{for(var n=u(t.drag.data.getCells()),i=n.next();!i.done;i=n.next()){i.value.style.transform=""}}catch(t){r={error:t}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}}))},e.prototype.monkeyPatchDropListRef=function(){var t=this,e=this._dropListRef,r=e._sortItem,o=e.enter;this.pblDropListRef.enter=function(e,r,n){var i=t.lastSorted;if(t.lastSorted=void 0,i&&i.drag===e){var s="horizontal"===t.orientation;r=i.clientRect.left+1-(s?i.offset:0),n=i.clientRect.top+1-(s?0:i.offset)}o.call(t._dropListRef,e,r,n)},this.pblDropListRef._sortItem=function(e,o,n,i){var s,a,l=t.pblGetPositionCacheItems;t.lastSorted=l.find((function(t){return t.drag===e}));var p=t.pblGetItemIndexFromPointerPosition(e,o,n,i);if(!(-1===p&&l.length>0)){var c=l.slice(),d="horizontal"===t.orientation,g=l[p];if(!g.drag.data.column.wontBudge){var f=t.lastSwap?t.lastSwap:e,h=l.findIndex((function(t){return t.drag===f})),y=Math.min(p,h),m=l.slice(y,Math.abs(p-h)+y);try{for(var b=u(m),D=b.next();!D.done;D=b.next()){var v=D.value;if(v.drag.data.column.wontBudge&&v.drag!==e)return}}catch(t){s={error:t}}finally{try{D&&!D.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}e.data.column.checkGroupLockConstraint(g.drag.data.column)&&(r.call(t._dropListRef,e,o,n,i),t.lastSwap=g.drag,d&&l.forEach((function(t,e){var r,o;if(c[e]!==t)try{for(var n=u(t.drag.data.getCells()),i=n.next();!i.done;i=n.next()){i.value.style.transform="translate3d("+t.offset+"px, 0, 0)"}}catch(t){r={error:t}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}})))}}}},e.decorators=[{type:r.Directive,args:[{selector:"pbl-ngrid[columnReorder]",exportAs:"pblNgridColumnReorder",inputs:["directContainerElement:cdkDropListDirectContainerElement"],host:{class:"cdk-drop-list","[id]":"id","[class.cdk-drop-list-dragging]":"_dropListRef.isDragging()","[class.cdk-drop-list-receiving]":"_dropListRef.isReceiving()"},providers:[{provide:o.DragDrop,useExisting:D},{provide:o.CDK_DROP_LIST,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:p.PblNgridComponent},{type:p.PblNgridPluginController},{type:r.ElementRef},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:l.Directionality,decorators:[{type:r.Optional}]},{type:o.CdkDropListGroup,decorators:[{type:r.Optional},{type:r.SkipSelf}]}]},e.propDecorators={columnReorder:[{type:r.Input}],manualOverride:[{type:r.Input}],dragging:[{type:r.Output,args:["cdkDropDragging"]}]},e}(o.CdkDropList);var x=function(t){function e(e,r,o,n,i,s,a,l,p){var c=t.call(this,e,r,o,n,i,s,a,l,p)||this;return c.rootElementSelector="pbl-ngrid-header-cell",c._hostNotRoot=!1,c}return g(e,t),Object.defineProperty(e.prototype,"context",{set:function(t){this._context=t,this.column=t&&t.col;var e=this.pluginCtrl=t&&p.PblNgridPluginController.find(t.grid),r=e&&e.getPlugin("columnReorder");this.cdkDropList=r||void 0,this.disabled=!this.column||!this.column.reorder},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rootElementSelectorClass",{set:function(t){var e,r;t!==this._rootClass&&this._hostNotRoot&&(this._rootClass&&(e=this.getRootElement().classList).remove.apply(e,h(this._rootClass.split(" "))),t&&(r=this.getRootElement().classList).add.apply(r,h(t.split(" ")))),this._rootClass=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblDragRef",{get:function(){return this._dragRef},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cdkDropList",{get:function(){return this.dropContainer},set:function(t){this.cdkDropList&&this.cdkDropList.removeDrag(this),this.dropContainer=t,t&&(this._dragRef._withDropContainer(t._dropListRef),t.addDrag(this))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){_.prototype.ngOnInit.call(this)},e.prototype.ngOnDestroy=function(){_.prototype.ngOnDestroy.call(this),t.prototype.ngOnDestroy.call(this)},e.prototype.ngAfterViewInit=function(){var e=this;_.prototype.ngAfterViewInit.call(this),t.prototype.ngAfterViewInit.call(this),this._dragRef.beforeStarted.subscribe((function(){var t=e.cdkDropList;if(t&&t.columnReorder&&e._context.col.reorder&&t._dropListRef.isDragging())return e.disabled=!0})),this.started.subscribe((function(){return e._context.col.columnDef.isDragging=!0})),this.ended.subscribe((function(){return e._context.col.columnDef.isDragging=!1}))},e.prototype.getCells=function(){return this.cache||(this.cache=this._context.col.columnDef.queryCellElements("table")),this.cache},e.prototype.reset=function(){var e,r;if(t.prototype.reset.call(this),this.cache){try{for(var o=u(this.cache),n=o.next();!n.done;n=o.next()){n.value.style.transform=""}}catch(t){e={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}this.cache=void 0}},e.decorators=[{type:r.Directive,args:[{selector:"[pblNgridColumnDrag]",exportAs:"pblNgridColumnDrag",host:{class:"cdk-drag","[class.cdk-drag-dragging]":"_dragRef.isDragging()"},providers:[{provide:o.DragDrop,useExisting:D},{provide:o.CdkDrag,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:r.ElementRef},{type:o.CdkDropList,decorators:[{type:r.Inject,args:[o.CDK_DROP_LIST]},{type:r.Optional},{type:r.SkipSelf}]},{type:void 0,decorators:[{type:r.Inject,args:[s.DOCUMENT]}]},{type:r.NgZone},{type:r.ViewContainerRef},{type:void 0,decorators:[{type:r.Inject,args:[o.CDK_DRAG_CONFIG]}]},{type:l.Directionality},{type:o.DragDrop},{type:r.ChangeDetectorRef}]},e.propDecorators={context:[{type:r.Input,args:["pblNgridColumnDrag"]}],rootElementSelectorClass:[{type:r.Input,args:["cdkDragRootElementClass"]}],cdkDropList:[{type:r.Input}]},e}(o.CdkDrag);var S=c.normalizePassiveListenerOptions({passive:!0}),w=c.normalizePassiveListenerOptions({passive:!1}),O=function(){function t(t,e,r,o,i,s){var a=this;this.element=t,this._ngZone=e,this._viewportRuler=r,this._dragDropRegistry=o,this._config=i,this._dir=s,this.grabAreaWidth=6,this._pointerMoveSubscription=n.Subscription.EMPTY,this._pointerUpSubscription=n.Subscription.EMPTY,this._rootElementInitSubscription=n.Subscription.EMPTY,this._pointerDown=function(t){a._initializeDragSequence(a._rootElement,t)},this._pointerMove=function(t){var e=a._getPointerPositionOnPage(t),r=e.x-a._pickupPositionOnPage.x,o=e.y-a._pickupPositionOnPage.y;if(a._hasStartedDragging){a._hasMoved=!0,t.preventDefault(),t.stopPropagation();var n=Math.max(0,a._initialWidth+r);n>a.column.maxWidth?n=a.column.maxWidth:r<0&&n<a.column.minWidth&&(n=a.column.minWidth),a._lastWidth!==n&&(a._lastWidth=n,a.column.updateWidth(n+"px"),a.grid.resetColumnsWidth())}else Math.abs(r)+Math.abs(o)>=a._config.dragStartThreshold&&(a._hasStartedDragging=!0,a.column.sizeInfo.updateSize(),a._lastWidth=a._initialWidth=a.column.columnDef.netWidth)},this._pointerUp=function(){a._isDragging()&&(a._removeSubscriptions(),a._dragDropRegistry.stopDragging(a),a._hasStartedDragging&&a.grid.columnApi.resizeColumn(a.column,a._lastWidth+"px"))},o.registerDragItem(this)}return Object.defineProperty(t.prototype,"context",{set:function(t){if(t){var e=t.col,r=t.grid;if(p.isPblColumn(e))return this.column=e,void(this.grid=r)}this.column=this.grid=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"table",{get:function(){return this.grid},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t=this;this._rootElementInitSubscription=this._ngZone.onStable.asObservable().pipe(e.take(1)).subscribe((function(){var e,r,o=t._rootElement=t._getRootElement();o.parentElement.classList.add("pbl-ngrid-column-resize"),o.addEventListener("mousedown",t._pointerDown,w),o.addEventListener("touchstart",t._pointerDown,S),r=(e=!1)?"":"none",function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}(o.style,{touchAction:e?"":"none",webkitUserDrag:e?"":"none",webkitTapHighlightColor:e?"":"transparent",userSelect:r,msUserSelect:r,webkitUserSelect:r,MozUserSelect:r})}))},t.prototype.ngOnDestroy=function(){this._rootElement&&(this._rootElement.removeEventListener("mousedown",this._pointerDown,w),this._rootElement.removeEventListener("touchstart",this._pointerDown,S)),this._rootElementInitSubscription.unsubscribe(),this._dragDropRegistry.removeDragItem(this),this._removeSubscriptions()},t.prototype.onDoubleClick=function(t){this.grid.columnApi.autoSizeColumn(this.column)},t.prototype._initializeDragSequence=function(t,r){r.stopPropagation(),this._isDragging()||!this._isTouchEvent(r)&&0!==r.button||(this._hasStartedDragging=this._hasMoved=!1,this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.pipe(e.auditTime(0,n.animationFrameScheduler)).subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollPosition=this._viewportRuler.getViewportScrollPosition(),this._pickupPositionOnPage=this._getPointerPositionOnPage(r),this._dragDropRegistry.startDragging(this,r))},t.prototype._getPointerPositionOnPage=function(t){var e=this._isTouchEvent(t)?t.touches[0]:t;return{x:e.pageX-this._scrollPosition.left,y:e.pageY-this._scrollPosition.top}},t.prototype._isTouchEvent=function(t){return t.type.startsWith("touch")},t.prototype._isDragging=function(){return this._dragDropRegistry.isDragging(this)},t.prototype._getRootElement=function(){return this.element.nativeElement},t.prototype._removeSubscriptions=function(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe()},t.decorators=[{type:r.Component,args:[{selector:"pbl-ngrid-drag-resize",host:{class:"pbl-ngrid-column-resizer","[style.width.px]":"grabAreaWidth"},template:"<ng-content></ng-content>\n",changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,styles:[".pbl-ngrid-column-resizer{position:absolute;right:0;height:100%;cursor:col-resize;z-index:50000}"]}]}],t.ctorParameters=function(){return[{type:r.ElementRef},{type:r.NgZone},{type:a.ViewportRuler},{type:o.DragDropRegistry},{type:void 0,decorators:[{type:r.Inject,args:[o.CDK_DRAG_CONFIG]}]},{type:l.Directionality,decorators:[{type:r.Optional}]}]},t.propDecorators={context:[{type:r.Input}],grabAreaWidth:[{type:r.Input}],onDoubleClick:[{type:r.HostListener,args:["dblclick",["$event"]]}]},t}();var I=function(t){function e(e,r){var o=t.call(this,e,r)||this;return o.name="cellDragger",o.kind="dataHeaderExtensions",o}return g(e,t),e.prototype.shouldRender=function(t){return p.PblNgridPluginController.find(t.grid).hasPlugin("columnReorder")},e.decorators=[{type:r.Directive,args:[{selector:"[pblNgridCellDraggerRef]"}]}],e.ctorParameters=function(){return[{type:r.TemplateRef},{type:p.PblNgridRegistryService}]},e}(p.PblNgridMultiTemplateRegistry);function N(t){var e,r;try{for(var o=u(this.groups),n=o.next();!n.done;n=o.next()){var i=n.value,s=this.groupStore.find(i);if(s&&s.lockColumns&&!t.isInGroup(s))return!1}}catch(t){e={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return!0}function j(){p.PblColumn.extendProperty("reorder"),p.PblColumn.extendProperty("wontBudge"),p.PblColumnGroup.extendProperty("lockColumns"),p.PblColumn.prototype.checkGroupLockConstraint=function(t){return N.call(this,t)&&N.call(t,this)}}var z=0,A=function(t){function e(e,r,o,n,i,s,a){var l=t.call(this,o,n,i,s,a)||this;return l.grid=e,l.id="pbl-ngrid-column-aggregation-container-"+z++,l.orientation="horizontal",l._draggablesSet=new Set,r.getPlugin("columnReorder").connectedTo=l.id,l.pblDropListRef.dropped.subscribe((function(t){var e=t.item;l.pending=void 0,l.grid.columnApi.addGroupBy(e.data.column)})),l.pblDropListRef.entered.subscribe((function(t){var e,r,o=t.item;l.pending=o.data.column,o.getPlaceholderElement().style.display="none";try{for(var n=u(o.data.getCells()),i=n.next();!i.done;i=n.next()){i.value.style.display="none"}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}})),l.pblDropListRef.exited.subscribe((function(t){var e,r,o=t.item;l.pending=void 0,o.getPlaceholderElement().style.display="";try{for(var n=u(o.data.getCells()),i=n.next();!i.done;i=n.next()){i.value.style.display=""}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}})),l}return g(e,t),Object.defineProperty(e.prototype,"pblDropListRef",{get:function(){return this._dropListRef},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){v.prototype.ngOnInit.call(this)},e.prototype.addDrag=function(t){return v.prototype.addDrag.call(this,t)},e.prototype.removeDrag=function(t){return v.prototype.removeDrag.call(this,t)},e.prototype.beforeStarted=function(){v.prototype.beforeStarted.call(this)},e.decorators=[{type:r.Directive,args:[{selector:"[pblAggregationContainer]",exportAs:"pblAggregationContainer",inputs:["directContainerElement:cdkDropListDirectContainerElement"],host:{class:"cdk-drop-list","[id]":"id"},providers:[{provide:o.DragDrop,useExisting:D},{provide:o.CDK_DROP_LIST,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:p.PblNgridComponent},{type:p.PblNgridPluginController},{type:r.ElementRef},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:l.Directionality,decorators:[{type:r.Optional}]},{type:o.CdkDropListGroup,decorators:[{type:r.Optional},{type:r.SkipSelf}]}]},e}(o.CdkDropList);var M=function(t){function e(e,r){var o=t.call(this,e,r)||this;return o.name="cellResizer",o.kind="dataHeaderExtensions",o}return g(e,t),e.prototype.shouldRender=function(t){return!!t.col.resize},e.decorators=[{type:r.Directive,args:[{selector:"[pblNgridCellResizerRef]"}]}],e.ctorParameters=function(){return[{type:r.TemplateRef},{type:p.PblNgridRegistryService}]},e}(p.PblNgridMultiTemplateRegistry);function T(){p.PblColumn.extendProperty("resize")}var G=function(){function t(){}return t.decorators=[{type:r.Component,args:[{selector:"pbl-drag-plugin-default-templates",template:'<pbl-ngrid-drag-resize *pblNgridCellResizerRef="let ctx" [context]="ctx"></pbl-ngrid-drag-resize>\n<span *pblNgridCellDraggerRef="let ctx" [pblNgridColumnDrag]="ctx" cdkDragRootElementClass="cdk-drag"></span>',changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None}]}],t}();function V(){return[p.ngridPlugin({id:"rowReorder"},P),p.ngridPlugin({id:"columnReorder",runOnce:j},L),p.ngridPlugin({id:"columnResize",runOnce:T},O)]}var W=function(){function t(){}return t.withDefaultTemplates=function(){return{ngModule:t,providers:p.provideCommon([{component:G}])}},t.NGRID_PLUGIN=V(),t.decorators=[{type:r.NgModule,args:[{imports:[s.CommonModule,p.PblNgridModule,o.DragDropModule],declarations:[G,v,_,R,P,E,L,x,I,A,O,M],exports:[o.DragDropModule,v,_,R,P,E,L,x,I,A,O,M],entryComponents:[G]}]}],t}();t.CdkLazyDrag=_,t.CdkLazyDropList=v,t.PblDragHandle=R,t.PblNgridColumnDragDirective=x,t.PblNgridColumnReorderPluginDirective=L,t.PblNgridDragModule=W,t.PblNgridDragResizeComponent=O,t.PblNgridRowDragDirective=E,t.PblNgridRowReorderPluginDirective=P,t.ɵa="rowReorder",t.ɵb="columnReorder",t.ɵc="columnResize",t.ɵd=V,t.ɵe=D,t.ɵf=G,t.ɵg=I,t.ɵh=A,t.ɵi=M,t.ɵj=j,t.ɵk=T,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=pebula-ngrid-drag.umd.min.js.map