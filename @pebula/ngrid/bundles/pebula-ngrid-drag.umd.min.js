!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/operators"),require("@angular/core"),require("@angular/cdk/drag-drop"),require("rxjs"),require("@angular/cdk/coercion"),require("@angular/common"),require("@angular/cdk/bidi"),require("@angular/cdk/scrolling"),require("@pebula/ngrid"),require("@angular/cdk/platform")):"function"==typeof define&&define.amd?define("@pebula/ngrid/drag",["exports","rxjs/operators","@angular/core","@angular/cdk/drag-drop","rxjs","@angular/cdk/coercion","@angular/common","@angular/cdk/bidi","@angular/cdk/scrolling","@pebula/ngrid","@angular/cdk/platform"],e):e(((t=t||self).pebula=t.pebula||{},t.pebula.ngrid=t.pebula.ngrid||{},t.pebula.ngrid.drag={}),t.rxjs.operators,t.ng.core,t.ng.cdk["drag-drop"],t.rxjs,t.ng.cdk.coercion,t.ng.common,t.ng.cdk.bidi,t.ng.cdk.scrolling,t.pebula.ngrid,t.ng.cdk.platform)}(this,(function(t,e,r,o,n,i,s,a,p,l,c){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var d=function(t,e){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function g(t,e){function r(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function u(t,e,r,o){var n,i=arguments.length,s=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,r,s):n(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function f(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function y(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function h(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t}var b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.beforeExit=new n.Subject,e}return g(e,t),e.prototype.withElement=function(t){return this.element=i.coerceElement(t),this},e.prototype.dispose=function(){this.beforeExit.complete(),t.prototype.dispose.call(this)},e}(o.DropListRef);var D=function(t){function e(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var n=t.apply(this,m(e))||this;return n.rootElementChanged=new r.EventEmitter,n.exited.subscribe((function(t){var e=t.container;e instanceof b&&e.beforeExit.next({item:n})})),n}return g(e,t),e.prototype.withRootElement=function(e){if(this.rootElementChanged){var r=i.coerceElement(e);this.getRootElement()!==r&&this.rootElementChanged.next({prev:this.getRootElement(),curr:r})}return t.prototype.withRootElement.call(this,e)},e.prototype.dispose=function(){this.rootElementChanged.complete(),t.prototype.dispose.call(this)},e}(o.DragRef);var v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._draggablesSet=new Set,e}return g(e,t),Object.defineProperty(e.prototype,"pblDropListRef",{get:function(){return this._dropListRef},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;if(this.pblDropListRef instanceof b==!1)throw new Error("Invalid `DropListRef` injection, the ref is not an instance of PblDropListRef");this._dropListRef.beforeStarted.subscribe((function(){return t.beforeStarted()}))},e.prototype.addDrag=function(t){this._draggablesSet.add(t),this._draggables.reset(Array.from(this._draggablesSet.values())),this._draggables.notifyOnChanges()},e.prototype.removeDrag=function(t){var e=this._draggablesSet.delete(t);return e&&(this._draggables.reset(Array.from(this._draggablesSet.values())),this._draggables.notifyOnChanges()),e},e.prototype.beforeStarted=function(){if(this.originalElement||(this.originalElement=this.element),this.directContainerElement){var t=this.originalElement.nativeElement.querySelector(this.directContainerElement);this.element=new r.ElementRef(t)}else this.element=this.originalElement;this.pblDropListRef.withElement(this.element)},e.decorators=[{type:r.Directive,args:[{selector:"[cdkLazyDropList]",exportAs:"cdkLazyDropList",providers:[{provide:o.CDK_DROP_LIST,useClass:e}],host:{class:"cdk-drop-list","[id]":"id","[class.cdk-drop-list-dragging]":"_dropListRef.isDragging()","[class.cdk-drop-list-receiving]":"_dropListRef.isReceiving()"}}]}],e.propDecorators={directContainerElement:[{type:r.Input,args:["cdkDropListDirectContainerElement"]}]},e}(o.CdkDropList);var R=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._hostNotRoot=!1,e}return g(o,t),Object.defineProperty(o.prototype,"rootElementSelectorClass",{set:function(t){var e,r;t!==this._rootClass&&this._hostNotRoot&&(this._rootClass&&(e=this.getRootElement().classList).remove.apply(e,m(this._rootClass.split(" "))),t&&(r=this.getRootElement().classList).add.apply(r,m(t.split(" ")))),this._rootClass=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"pblDragRef",{get:function(){return this._dragRef},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"cdkDropList",{get:function(){return this.dropContainer},set:function(t){this.cdkDropList&&this.cdkDropList.removeDrag(this),this.dropContainer=t,t&&(this._dragRef._withDropContainer(t._dropListRef),t.addDrag(this))},enumerable:!0,configurable:!0}),o.prototype.ngOnInit=function(){var t=this;if(this.pblDragRef instanceof D==!1)throw new Error("Invalid `DragRef` injection, the ref is not an instance of PblDragRef");this.pblDragRef.rootElementChanged.subscribe((function(e){var r,o,n=t._rootClass,i=t.element.nativeElement!==e.curr;n&&(t._hostNotRoot&&(r=e.prev.classList).remove.apply(r,m(n.split(" "))),i&&(o=e.curr.classList).add.apply(o,m(n.split(" ")))),t._hostNotRoot=i}))},o.prototype.ngAfterViewInit=function(){var t=this;this.started.subscribe((function(r){if(t.dropContainer){var o=t.getRootElement(),n=o.parentNode;o.nextSibling||n===t.dropContainer.element.nativeElement||t.ended.pipe(e.take(1)).subscribe((function(t){return n.appendChild(o)}))}}))},o.prototype.ngOnDestroy=function(){this.cdkDropList&&this.cdkDropList.removeDrag(this)},o.decorators=[{type:r.Directive,args:[{selector:"[cdkLazyDrag]",exportAs:"cdkLazyDrag",host:{class:"cdk-drag","[class.cdk-drag-dragging]":"_dragRef.isDragging()"}}]}],o.propDecorators={rootElementSelectorClass:[{type:r.Input,args:["cdkDragRootElementClass"]}],cdkDropList:[{type:r.Input}]},o}(o.CdkDrag);var _=function(t){function e(e,r){var o=t.call(this,e,r)||this;return o.element=e,o}return g(e,t),e.decorators=[{type:r.Directive,args:[{selector:"[pblDragHandle]",host:{class:"cdk-drag-handle"},providers:[{provide:o.CdkDragHandle,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:r.ElementRef},{type:o.CdkDrag,decorators:[{type:r.Optional}]}]},e}(o.CdkDragHandle);var C=7===o.CdkDropList.length;function P(t,e,r,o,n,i,s){return C?[t,i,r,o,n,s,e]:[t,e,r,o,n]}function E(t,e,r,o,n,i,s,a,p,l,c){return C?[t,e,r,o,n,l,c,i,s,a]:[t,e,r,o,n,i,s,a,p]}var O="rowReorder",k=0,L=function(t){function e(e,r,o,n,i,s,a,p,l){var c=t.apply(this,m(P(o,n,i,s,a,p,l)))||this;return c.grid=e,c.id="pbl-ngrid-row-reorder-list-"+k++,c._rowReorder=!1,c.directContainerElement=".pbl-ngrid-scroll-container",c._draggablesSet=new Set,c._removePlugin=r.setPlugin(O,c),c.dropped.subscribe((function(t){var r=t.item,o=e.ds.source.indexOf(r.draggedContext.row),n=t.currentIndex+e.ds.renderStart;c.grid.contextApi.clear(),c.grid.ds.moveItem(o,n,!0),c.grid._cdkTable.syncRows("data")})),c}var n;return g(e,t),n=e,Object.defineProperty(e.prototype,"rowReorder",{get:function(){return this._rowReorder},set:function(t){t=i.coerceBooleanProperty(t),this._rowReorder=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblDropListRef",{get:function(){return this._dropListRef},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){v.prototype.ngOnInit.call(this)},e.prototype.addDrag=function(t){return v.prototype.addDrag.call(this,t)},e.prototype.removeDrag=function(t){return v.prototype.removeDrag.call(this,t)},e.prototype.beforeStarted=function(){v.prototype.beforeStarted.call(this)},e.prototype.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this),this._removePlugin(this.grid)},e.ctorParameters=function(){return[{type:l.PblNgridComponent},{type:l.PblNgridPluginController},{type:r.ElementRef},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:a.Directionality},{type:o.CdkDropListGroup},{type:o.DragDropRegistry},{type:void 0}]},e.decorators=[{type:r.Directive,args:[{selector:"pbl-ngrid[rowReorder]",exportAs:"pblNgridRowReorder",inputs:["directContainerElement:cdkDropListDirectContainerElement"],host:{class:"cdk-drop-list","[id]":"id","[class.cdk-drop-list-dragging]":"_dropListRef.isDragging()","[class.cdk-drop-list-receiving]":"_dropListRef.isReceiving()","[class.pbl-row-reorder]":"rowReorder && !this.grid.ds?.sort.sort?.order && !this.grid.ds?.filter?.filter"},providers:[{provide:o.CdkDropListGroup,useValue:void 0},{provide:o.CDK_DROP_LIST,useExisting:n}]}]}],e.ctorParameters=function(){return[{type:l.PblNgridComponent},{type:l.PblNgridPluginController},{type:r.ElementRef},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:a.Directionality,decorators:[{type:r.Optional}]},{type:o.CdkDropListGroup,decorators:[{type:r.Optional},{type:r.SkipSelf}]},{type:o.DragDropRegistry,decorators:[{type:r.Optional}]},{type:void 0,decorators:[{type:r.Optional},{type:r.Inject,args:[s.DOCUMENT]}]}]},e.propDecorators={rowReorder:[{type:r.Input}]},e=n=u([l.NgridPlugin({id:O}),f("design:paramtypes",[l.PblNgridComponent,l.PblNgridPluginController,r.ElementRef,o.DragDrop,r.ChangeDetectorRef,a.Directionality,o.CdkDropListGroup,o.DragDropRegistry,Object])],e)}(o.CdkDropList);var S=function(t){function e(e,r,o,n,i,s,a,p,l,c,d){var g=t.apply(this,m(E(e,r,o,n,i,s,a,p,l,c,d)))||this;return g.rootElementSelector="pbl-ngrid-row",g._hostNotRoot=!1,g.started.subscribe((function(t){var e=g._context,r=e.col,o=e.row,n=e.grid,i=e.value;g._draggedContext={col:r,row:o,grid:n,value:i}})),g}return g(e,t),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},set:function(t){this._context=t;var e=this.pluginCtrl=t&&l.PblNgridPluginController.find(t.grid),r=e&&e.getPlugin(O);this.cdkDropList=r||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"draggedContext",{get:function(){return this._draggedContext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rootElementSelectorClass",{set:function(t){var e,r;t!==this._rootClass&&this._hostNotRoot&&(this._rootClass&&(e=this.getRootElement().classList).remove.apply(e,m(this._rootClass.split(" "))),t&&(r=this.getRootElement().classList).add.apply(r,m(t.split(" ")))),this._rootClass=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblDragRef",{get:function(){return this._dragRef},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cdkDropList",{get:function(){return this.dropContainer},set:function(t){this.cdkDropList&&this.cdkDropList.removeDrag(this),this.dropContainer=t,t&&(this._dragRef._withDropContainer(t._dropListRef),t.addDrag(this))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){R.prototype.ngOnInit.call(this)},e.prototype.ngAfterViewInit=function(){R.prototype.ngAfterViewInit.call(this),t.prototype.ngAfterViewInit.call(this)},e.prototype.ngOnDestroy=function(){R.prototype.ngOnDestroy.call(this),t.prototype.ngOnDestroy.call(this)},e.decorators=[{type:r.Directive,args:[{selector:"[pblNgridRowDrag]",exportAs:"pblNgridRowDrag",host:{class:"cdk-drag","[class.cdk-drag-dragging]":"_dragRef.isDragging()"},providers:[{provide:o.CdkDrag,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:r.ElementRef},{type:o.CdkDropList,decorators:[{type:r.Inject,args:[o.CDK_DROP_LIST]},{type:r.Optional},{type:r.SkipSelf}]},{type:void 0,decorators:[{type:r.Inject,args:[s.DOCUMENT]}]},{type:r.NgZone},{type:r.ViewContainerRef},{type:void 0,decorators:[{type:r.Inject,args:[o.CDK_DRAG_CONFIG]}]},{type:a.Directionality},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:p.ViewportRuler,decorators:[{type:r.Optional}]},{type:o.DragDropRegistry,decorators:[{type:r.Optional}]}]},e.propDecorators={context:[{type:r.Input,args:["pblNgridRowDrag"]}],rootElementSelectorClass:[{type:r.Input,args:["cdkDragRootElementClass"]}],cdkDropList:[{type:r.Input}]},e}(o.CdkDrag);var w={dragStartThreshold:5,pointerDirectionChangeThreshold:5},x=function(){function t(t,e,r,o){this._document=t,this._ngZone=e,this._viewportRuler=r,this._dragDropRegistry=o}return t.prototype.createDrag=function(t,e){return void 0===e&&(e=w),new D(t,e,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)},t.prototype.createDropList=function(t){return new b(t,this._dragDropRegistry,this._document)},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:[s.DOCUMENT]}]},{type:r.NgZone},{type:p.ViewportRuler},{type:o.DragDropRegistry}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(s.DOCUMENT),r.ɵɵinject(r.NgZone),r.ɵɵinject(p.ViewportRuler),r.ɵɵinject(o.DragDropRegistry))},token:t,providedIn:"root"}),t}();function I(t){var e,r;try{for(var o=y(this.groups),n=o.next();!n.done;n=o.next()){var i=n.value,s=this.groupStore.find(i);if(s&&s.lockColumns&&!t.isInGroup(s))return!1}}catch(t){e={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return!0}function N(){l.PblColumn.extendProperty("reorder"),l.PblColumn.extendProperty("wontBudge"),l.PblColumnGroup.extendProperty("lockColumns"),l.PblColumn.prototype.checkGroupLockConstraint=function(t){return I.call(this,t)&&I.call(t,this)}}var j="columnReorder",z=0,M=function(t){function e(e,r,o,i,s,a,p,l,c){var d=t.apply(this,m(P(o,i,s,a,p,l,c)))||this;return d.table=e,d.id="pbl-ngrid-column-reorder-list-"+z++,d.orientation="horizontal",d.dragging=new n.BehaviorSubject(!1),d._columnReorder=!1,d._manualOverride=!1,d._draggablesSet=new Set,d._removePlugin=r.setPlugin(j,d),d.directContainerElement=".pbl-ngrid-header-row-main",d.dropped.subscribe((function(t){d.manualOverride||d.table.columnApi.moveColumn(t.item.column,t.currentIndex)})),d.dragging.subscribe((function(t){var e=o.nativeElement;t?e.classList.add("pbl-ngrid-column-list-dragging"):e.classList.remove("pbl-ngrid-column-list-dragging"),d.lastSwap=void 0})),d.monkeyPatchDropListRef(),d}var p;return g(e,t),p=e,Object.defineProperty(e.prototype,"columnReorder",{get:function(){return this._columnReorder},set:function(t){t=i.coerceBooleanProperty(t),this._columnReorder=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manualOverride",{get:function(){return this._manualOverride},set:function(t){this._manualOverride=i.coerceBooleanProperty(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblGetItemIndexFromPointerPosition",{get:function(){return this._dropListRef._getItemIndexFromPointerPosition.bind(this._dropListRef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblGetPositionCacheItems",{get:function(){return this._dropListRef._itemPositions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblDropListRef",{get:function(){return this._dropListRef},enumerable:!0,configurable:!0}),e.prototype.addDrag=function(t){return v.prototype.addDrag.call(this,t)},e.prototype.removeDrag=function(t){return v.prototype.removeDrag.call(this,t)},e.prototype.ngOnInit=function(){var t=this;v.prototype.ngOnInit.call(this),this.dropped.subscribe((function(e){return t._pblReset()})),this.pblDropListRef.beforeExit.subscribe((function(e){return t._pblReset()}))},e.prototype.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this),this._removePlugin(this.table)},e.prototype.beforeStarted=function(){v.prototype.beforeStarted.call(this),this.lastSorted=void 0,this.dragging.next(!0)},e.prototype._pblReset=function(){this.dragging.next(!1),this.pblGetPositionCacheItems.forEach((function(t,e){var r,o;try{for(var n=y(t.drag.data.getCells()),i=n.next();!i.done;i=n.next()){i.value.style.transform=""}}catch(t){r={error:t}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}}))},e.prototype.monkeyPatchDropListRef=function(){var t=this,e=this._dropListRef,r=e._sortItem,o=e.enter;this.pblDropListRef.enter=function(e,r,n){var i=t.lastSorted;if(t.lastSorted=void 0,i&&i.drag===e){var s="horizontal"===t.orientation;r=i.clientRect.left+1-(s?i.offset:0),n=i.clientRect.top+1-(s?0:i.offset)}o.call(t._dropListRef,e,r,n)},this.pblDropListRef._sortItem=function(e,o,n,i){var s,a,p=t.pblGetPositionCacheItems;t.lastSorted=p.find((function(t){return t.drag===e}));var l=t.pblGetItemIndexFromPointerPosition(e,o,n,i);if(!(-1===l&&p.length>0)){var c=p.slice(),d="horizontal"===t.orientation,g=p[l];if(!g.drag.data.column.wontBudge){var u=t.lastSwap?t.lastSwap:e,f=p.findIndex((function(t){return t.drag===u})),h=Math.min(l,f),m=p.slice(h,Math.abs(l-f)+h);try{for(var b=y(m),D=b.next();!D.done;D=b.next()){var v=D.value;if(v.drag.data.column.wontBudge&&v.drag!==e)return}}catch(t){s={error:t}}finally{try{D&&!D.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}e.data.column.checkGroupLockConstraint(g.drag.data.column)&&(r.call(t._dropListRef,e,o,n,i),t.lastSwap=g.drag,d&&p.forEach((function(t,e){var r,o;if(c[e]!==t)try{for(var n=y(t.drag.data.getCells()),i=n.next();!i.done;i=n.next()){i.value.style.transform="translate3d("+t.offset+"px, 0, 0)"}}catch(t){r={error:t}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}})))}}}},e.ctorParameters=function(){return[{type:l.PblNgridComponent},{type:l.PblNgridPluginController},{type:r.ElementRef},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:a.Directionality},{type:o.CdkDropListGroup},{type:o.DragDropRegistry},{type:void 0}]},e.decorators=[{type:r.Directive,args:[{selector:"pbl-ngrid[columnReorder]",exportAs:"pblNgridColumnReorder",inputs:["directContainerElement:cdkDropListDirectContainerElement"],host:{class:"cdk-drop-list","[id]":"id","[class.cdk-drop-list-dragging]":"_dropListRef.isDragging()","[class.cdk-drop-list-receiving]":"_dropListRef.isReceiving()"},providers:[{provide:o.CDK_DROP_LIST,useExisting:p}]}]}],e.ctorParameters=function(){return[{type:l.PblNgridComponent},{type:l.PblNgridPluginController},{type:r.ElementRef},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:a.Directionality,decorators:[{type:r.Optional}]},{type:o.CdkDropListGroup,decorators:[{type:r.Optional},{type:r.SkipSelf}]},{type:o.DragDropRegistry,decorators:[{type:r.Optional}]},{type:void 0,decorators:[{type:r.Optional},{type:r.Inject,args:[s.DOCUMENT]}]}]},e.propDecorators={columnReorder:[{type:r.Input}],manualOverride:[{type:r.Input}],dragging:[{type:r.Output,args:["cdkDropDragging"]}]},e=p=u([l.NgridPlugin({id:j,runOnce:N}),f("design:paramtypes",[l.PblNgridComponent,l.PblNgridPluginController,r.ElementRef,o.DragDrop,r.ChangeDetectorRef,a.Directionality,o.CdkDropListGroup,o.DragDropRegistry,Object])],e)}(o.CdkDropList);var A=function(t){function e(e,r,o,n,i,s,a,p,l,c,d){var g=t.apply(this,m(E(e,r,o,n,i,s,a,p,l,c,d)))||this;return g.rootElementSelector="pbl-ngrid-header-cell",g._hostNotRoot=!1,g}return g(e,t),Object.defineProperty(e.prototype,"context",{set:function(t){this._context=t,this.column=t&&t.col;var e=this.pluginCtrl=t&&l.PblNgridPluginController.find(t.grid),r=e&&e.getPlugin(j);this.cdkDropList=r||void 0,this.disabled=!this.column||!this.column.reorder},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rootElementSelectorClass",{set:function(t){var e,r;t!==this._rootClass&&this._hostNotRoot&&(this._rootClass&&(e=this.getRootElement().classList).remove.apply(e,m(this._rootClass.split(" "))),t&&(r=this.getRootElement().classList).add.apply(r,m(t.split(" ")))),this._rootClass=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pblDragRef",{get:function(){return this._dragRef},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cdkDropList",{get:function(){return this.dropContainer},set:function(t){this.cdkDropList&&this.cdkDropList.removeDrag(this),this.dropContainer=t,t&&(this._dragRef._withDropContainer(t._dropListRef),t.addDrag(this))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){R.prototype.ngOnInit.call(this)},e.prototype.ngOnDestroy=function(){R.prototype.ngOnDestroy.call(this),t.prototype.ngOnDestroy.call(this)},e.prototype.ngAfterViewInit=function(){var e=this;R.prototype.ngAfterViewInit.call(this),t.prototype.ngAfterViewInit.call(this),this._dragRef.beforeStarted.subscribe((function(){var t=e.cdkDropList;if(t&&t.columnReorder&&e._context.col.reorder&&t._dropListRef.isDragging())return e.disabled=!0})),this.started.subscribe((function(){return e._context.col.columnDef.isDragging=!0})),this.ended.subscribe((function(){return e._context.col.columnDef.isDragging=!1}))},e.prototype.getCells=function(){return this.cache||(this.cache=this._context.col.columnDef.queryCellElements("table")),this.cache},e.prototype.reset=function(){var e,r;if(t.prototype.reset.call(this),this.cache){try{for(var o=y(this.cache),n=o.next();!n.done;n=o.next()){n.value.style.transform=""}}catch(t){e={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}this.cache=void 0}},e.decorators=[{type:r.Directive,args:[{selector:"[pblNgridColumnDrag]",exportAs:"pblNgridColumnDrag",host:{class:"cdk-drag","[class.cdk-drag-dragging]":"_dragRef.isDragging()"},providers:[{provide:o.CdkDrag,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:r.ElementRef},{type:o.CdkDropList,decorators:[{type:r.Inject,args:[o.CDK_DROP_LIST]},{type:r.Optional},{type:r.SkipSelf}]},{type:void 0,decorators:[{type:r.Inject,args:[s.DOCUMENT]}]},{type:r.NgZone},{type:r.ViewContainerRef},{type:void 0,decorators:[{type:r.Inject,args:[o.CDK_DRAG_CONFIG]}]},{type:a.Directionality},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:p.ViewportRuler,decorators:[{type:r.Optional}]},{type:o.DragDropRegistry,decorators:[{type:r.Optional}]}]},e.propDecorators={context:[{type:r.Input,args:["pblNgridColumnDrag"]}],rootElementSelectorClass:[{type:r.Input,args:["cdkDragRootElementClass"]}],cdkDropList:[{type:r.Input}]},e}(o.CdkDrag);function T(){l.PblColumn.extendProperty("resize")}var G=c.normalizePassiveListenerOptions({passive:!0}),V=c.normalizePassiveListenerOptions({passive:!1}),U=function(){function t(t,e,r,o,i,s){var a=this;this.element=t,this._ngZone=e,this._viewportRuler=r,this._dragDropRegistry=o,this._config=i,this._dir=s,this.grabAreaWidth=6,this._pointerMoveSubscription=n.Subscription.EMPTY,this._pointerUpSubscription=n.Subscription.EMPTY,this._rootElementInitSubscription=n.Subscription.EMPTY,this._pointerDown=function(t){a._initializeDragSequence(a._rootElement,t)},this._pointerMove=function(t){var e=a._getPointerPositionOnPage(t),r=e.x-a._pickupPositionOnPage.x,o=e.y-a._pickupPositionOnPage.y;if(a._hasStartedDragging){a._hasMoved=!0,t.preventDefault(),t.stopPropagation();var n=Math.max(0,a._initialWidth+r);n>a.column.maxWidth?n=a.column.maxWidth:r<0&&n<a.column.minWidth&&(n=a.column.minWidth),a._lastWidth!==n&&(a._lastWidth=n,a.column.updateWidth(n+"px"),a.grid.resetColumnsWidth())}else Math.abs(r)+Math.abs(o)>=a._config.dragStartThreshold&&(a._hasStartedDragging=!0,a.column.sizeInfo.updateSize(),a._lastWidth=a._initialWidth=a.column.columnDef.netWidth)},this._pointerUp=function(){a._isDragging()&&(a._removeSubscriptions(),a._dragDropRegistry.stopDragging(a),a._hasStartedDragging&&a.grid.columnApi.resizeColumn(a.column,a._lastWidth+"px"))},o.registerDragItem(this)}return Object.defineProperty(t.prototype,"context",{set:function(t){if(t){var e=t.col,r=t.grid;if(l.isPblColumn(e))return this.column=e,void(this.grid=r)}this.column=this.grid=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"table",{get:function(){return this.grid},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t=this;this._rootElementInitSubscription=this._ngZone.onStable.asObservable().pipe(e.take(1)).subscribe((function(){var e,r,o=t._rootElement=t._getRootElement();o.parentElement.classList.add("pbl-ngrid-column-resize"),o.addEventListener("mousedown",t._pointerDown,V),o.addEventListener("touchstart",t._pointerDown,G),r=(e=!1)?"":"none",function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}(o.style,{touchAction:e?"":"none",webkitUserDrag:e?"":"none",webkitTapHighlightColor:e?"":"transparent",userSelect:r,msUserSelect:r,webkitUserSelect:r,MozUserSelect:r})}))},t.prototype.ngOnDestroy=function(){this._rootElement&&(this._rootElement.removeEventListener("mousedown",this._pointerDown,V),this._rootElement.removeEventListener("touchstart",this._pointerDown,G)),this._rootElementInitSubscription.unsubscribe(),this._dragDropRegistry.removeDragItem(this),this._removeSubscriptions()},t.prototype.onDoubleClick=function(t){this.grid.columnApi.autoSizeColumn(this.column)},t.prototype._initializeDragSequence=function(t,r){r.stopPropagation(),this._isDragging()||!this._isTouchEvent(r)&&0!==r.button||(this._hasStartedDragging=this._hasMoved=!1,this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.pipe(e.auditTime(0,n.animationFrameScheduler)).subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollPosition=this._viewportRuler.getViewportScrollPosition(),this._pickupPositionOnPage=this._getPointerPositionOnPage(r),this._dragDropRegistry.startDragging(this,r))},t.prototype._getPointerPositionOnPage=function(t){var e=this._isTouchEvent(t)?t.touches[0]:t;return{x:e.pageX-this._scrollPosition.left,y:e.pageY-this._scrollPosition.top}},t.prototype._isTouchEvent=function(t){return t.type.startsWith("touch")},t.prototype._isDragging=function(){return this._dragDropRegistry.isDragging(this)},t.prototype._getRootElement=function(){return this.element.nativeElement},t.prototype._removeSubscriptions=function(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe()},t.ctorParameters=function(){return[{type:r.ElementRef},{type:r.NgZone},{type:p.ViewportRuler},{type:o.DragDropRegistry},{type:void 0},{type:a.Directionality}]},t.decorators=[{type:r.Component,args:[{selector:"pbl-ngrid-drag-resize",host:{class:"pbl-ngrid-column-resizer","[style.width.px]":"grabAreaWidth"},template:"<ng-content></ng-content>\n",changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,styles:[".pbl-ngrid-column-resizer{position:absolute;right:0;height:100%;cursor:col-resize;z-index:50000}"]}]}],t.ctorParameters=function(){return[{type:r.ElementRef},{type:r.NgZone},{type:p.ViewportRuler},{type:o.DragDropRegistry},{type:void 0,decorators:[{type:r.Inject,args:[o.CDK_DRAG_CONFIG]}]},{type:a.Directionality,decorators:[{type:r.Optional}]}]},t.propDecorators={context:[{type:r.Input}],grabAreaWidth:[{type:r.Input}],onDoubleClick:[{type:r.HostListener,args:["dblclick",["$event"]]}]},t=u([l.NgridPlugin({id:"columnResize",runOnce:T}),f("design:paramtypes",[r.ElementRef,r.NgZone,p.ViewportRuler,o.DragDropRegistry,Object,a.Directionality])],t)}();var W=function(t){function e(e,r){var o=t.call(this,e,r)||this;return o.name="cellDragger",o.kind="dataHeaderExtensions",o}return g(e,t),e.prototype.shouldRender=function(t){return l.PblNgridPluginController.find(t.grid).hasPlugin(j)},e.decorators=[{type:r.Directive,args:[{selector:"[pblNgridCellDraggerRef]"}]}],e.ctorParameters=function(){return[{type:r.TemplateRef},{type:l.PblNgridRegistryService}]},e}(l.PblNgridMultiTemplateRegistry);var q=0,Z=function(t){function e(e,r,o,n,i,s,a,p,l){var c=t.apply(this,m(P(o,n,i,s,a,p,l)))||this;return c.grid=e,c.id="pbl-ngrid-column-aggregation-container-"+q++,c.orientation="horizontal",c._draggablesSet=new Set,r.getPlugin("columnReorder").connectedTo=c.id,c.pblDropListRef.dropped.subscribe((function(t){var e=t.item;c.pending=void 0,c.grid.columnApi.addGroupBy(e.data.column)})),c.pblDropListRef.entered.subscribe((function(t){var e,r,o=t.item;c.pending=o.data.column,o.getPlaceholderElement().style.display="none";try{for(var n=y(o.data.getCells()),i=n.next();!i.done;i=n.next()){i.value.style.display="none"}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}})),c.pblDropListRef.exited.subscribe((function(t){var e,r,o=t.item;c.pending=void 0,o.getPlaceholderElement().style.display="";try{for(var n=y(o.data.getCells()),i=n.next();!i.done;i=n.next()){i.value.style.display=""}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}})),c}return g(e,t),Object.defineProperty(e.prototype,"pblDropListRef",{get:function(){return this._dropListRef},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){v.prototype.ngOnInit.call(this)},e.prototype.addDrag=function(t){return v.prototype.addDrag.call(this,t)},e.prototype.removeDrag=function(t){return v.prototype.removeDrag.call(this,t)},e.prototype.beforeStarted=function(){v.prototype.beforeStarted.call(this)},e.decorators=[{type:r.Directive,args:[{selector:"[pblAggregationContainer]",exportAs:"pblAggregationContainer",inputs:["directContainerElement:cdkDropListDirectContainerElement"],host:{class:"cdk-drop-list","[id]":"id"},providers:[{provide:o.CDK_DROP_LIST,useExisting:e}]}]}],e.ctorParameters=function(){return[{type:l.PblNgridComponent},{type:l.PblNgridPluginController},{type:r.ElementRef},{type:o.DragDrop},{type:r.ChangeDetectorRef},{type:a.Directionality,decorators:[{type:r.Optional}]},{type:o.CdkDropListGroup,decorators:[{type:r.Optional},{type:r.SkipSelf}]},{type:o.DragDropRegistry,decorators:[{type:r.Optional}]},{type:void 0,decorators:[{type:r.Optional},{type:r.Inject,args:[s.DOCUMENT]}]}]},e}(o.CdkDropList);var K=function(t){function e(e,r){var o=t.call(this,e,r)||this;return o.name="cellResizer",o.kind="dataHeaderExtensions",o}return g(e,t),e.prototype.shouldRender=function(t){return!!t.col.resize},e.decorators=[{type:r.Directive,args:[{selector:"[pblNgridCellResizerRef]"}]}],e.ctorParameters=function(){return[{type:r.TemplateRef},{type:l.PblNgridRegistryService}]},e}(l.PblNgridMultiTemplateRegistry);var B=function(){function t(){}return t.decorators=[{type:r.Component,args:[{selector:"pbl-drag-plugin-default-templates",template:'<pbl-ngrid-drag-resize *pblNgridCellResizerRef="let ctx" [context]="ctx"></pbl-ngrid-drag-resize>\n<span *pblNgridCellDraggerRef="let ctx" [pblNgridColumnDrag]="ctx" cdkDragRootElementClass="cdk-drag"></span>',changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None}]}],t}(),H=function(){function t(){}return t.withDefaultTemplates=function(){return{ngModule:t,providers:l.provideCommon([{component:B}])}},t.decorators=[{type:r.NgModule,args:[{imports:[s.CommonModule,l.PblNgridModule,o.DragDropModule],declarations:[B,v,R,_,L,S,M,A,W,Z,U,K],exports:[o.DragDropModule,v,R,_,L,S,M,A,W,Z,U,K],providers:[x,{provide:o.DragDrop,useExisting:x}],entryComponents:[B]}]}],t}();t.CdkLazyDrag=R,t.CdkLazyDropList=v,t.PblDragHandle=_,t.PblNgridColumnDragDirective=A,t.PblNgridColumnReorderPluginDirective=M,t.PblNgridDragModule=H,t.PblNgridDragResizeComponent=U,t.PblNgridRowDragDirective=S,t.PblNgridRowReorderPluginDirective=L,t.ɵa=j,t.ɵb="columnResize",t.ɵc=N,t.ɵd=T,t.ɵe=B,t.ɵf=W,t.ɵg=Z,t.ɵh=K,t.ɵi=x,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=pebula-ngrid-drag.umd.min.js.map